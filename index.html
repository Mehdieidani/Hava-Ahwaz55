<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§</title>
  <style>
    body {
      background: #111;
      color: #f0f0f0;
      font-family: "Tahoma", sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header, footer {
      padding: 1rem;
      background-color: #222;
    }
    input, button {
      padding: 10px;
      font-size: 1rem;
      margin: 5px;
    }
    .forecast {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .day-card, .hour-card {
      border: 1px solid #444;
      border-radius: 8px;
      margin: 8px;
      padding: 10px;
      background-color: #1a1a1a;
      width: 220px;
    }
    .hour-card {
      background-color: #2a2a2a;
    }
    .weather-icon {
      width: 60px;
    }
    .ad-box {
      margin: 15px 0;
      background-color: #333;
      padding: 10px;
      border-radius: 8px;
    }
    .settings {
      margin: 15px 0;
    }
    iframe {
      width: 100%;
      height: 250px;
      border: none;
    }
    .hidden {
      display: none;
    }
    .language-btn {
      position: absolute;
      left: 10px;
      top: 10px;
    }
    .day-details {
      background: #222;
      padding: 5px;
      margin-top: 8px;
      text-align: left;
      direction: rtl;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="title">ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§</h1>
    <button onclick="toggleLang()" class="language-btn" id="langToggle">AR</button>
  </header>

  <div class="settings">
    <input type="text" id="cityInput" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§ (Ù…Ø«Ù„Ø§Ù‹ Ø§Ù‡ÙˆØ§Ø² ÛŒØ§ Kazemi Do)" />
    <button onclick="searchCity()">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
  </div>

  <div class="ad-box">
    <a href="tel:09332356547" id="callLink">ğŸ“ ØªÙ…Ø§Ø³ Ø¨Ø§ 09332356547</a><br>
    <a href="https://instagram.com/mehdi.eidani" target="_blank">ğŸ“¸ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…: @mehdi.eidani</a><br>
    <a href="mailto:mehdi1eidani@gmail.com">âœ‰ï¸ Ø§ÛŒÙ…ÛŒÙ„: mehdi1eidani@gmail.com</a>
  </div>

  <div>
    <h2 id="cityName"></h2>
    <p id="shamsiDate"></p>
    <iframe id="mapFrame" src=""></iframe>
  </div>

  <h3>ğŸ“… Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
  <div class="forecast" id="dailyForecast"></div>

  <h3>ğŸ• Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ</h3>
  <div class="forecast" id="hourlyForecast"></div>

  <footer>
    <p>ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª - Mehdi Eidani</p>
  </footer>

<script>
  const API_KEY = "dc9c93f51cdd375d459483c2a9f86d88";
  let currentLang = "fa";

  const labels = {
    fa: {
      title: "ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§",
      searchPlaceholder: "Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§ (Ù…Ø«Ù„Ø§Ù‹ Ø§Ù‡ÙˆØ§Ø² ÛŒØ§ Kazemi Do)",
      call: "ğŸ“ ØªÙ…Ø§Ø³ Ø¨Ø§ 09332356547",
      forecastDaily: "ğŸ“… Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡",
      forecastHourly: "ğŸ• Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ"
    },
    ar: {
      title: "Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³",
      searchPlaceholder: "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ù‚Ø±ÙŠØ©",
      call: "ğŸ“ Ø§ØªØµÙ„ Ø¨Ù€ 09332356547",
      forecastDaily: "ğŸ“… Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©",
      forecastHourly: "ğŸ• Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª ÙƒÙ„ Ø³Ø§Ø¹Ø©"
    }
  };

  function toggleLang() {
    currentLang = currentLang === "fa" ? "ar" : "fa";
    document.documentElement.lang = currentLang;
    document.getElementById("title").innerText = labels[currentLang].title;
    document.getElementById("cityInput").placeholder = labels[currentLang].searchPlaceholder;
    document.getElementById("langToggle").innerText = currentLang === "fa" ? "AR" : "FA";
    document.getElementById("callLink").innerText = labels[currentLang].call;
    document.querySelector("h3").innerText = labels[currentLang].forecastDaily;
  }

  function toShamsi(date) {
    const d = new Date(date);
    return new Intl.DateTimeFormat('fa-IR-u-ca-persian', {
      dateStyle: 'full'
    }).format(d);
  }

  async function searchCity() {
    const city = document.getElementById("cityInput").value.trim();
    if (!city) return;

    try {
      const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=1&appid=${API_KEY}`);
      const geoData = await geoRes.json();
      if (!geoData.length) {
        alert("âŒ Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§ ÛŒØ§ÙØª Ù†Ø´Ø¯.");
        return;
      }

      const { lat, lon, name, country } = geoData[0];
      document.getElementById("cityName").innerText = `${name}, ${country}`;
      document.getElementById("mapFrame").src =
        `https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.2},${lat-0.2},${lon+0.2},${lat+0.2}&layer=mapnik`;

      const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&lang=${currentLang}&appid=${API_KEY}`);
      const data = await weatherRes.json();

      document.getElementById("shamsiDate").innerText = "ğŸ“… ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ²: " + toShamsi(Date.now());
      renderForecast(data);
    } catch (e) {
      alert("âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§ØªØŒ Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.");
      console.error(e);
    }
  }

  function renderForecast(data) {
    const daily = {};
    const dailyForecast = document.getElementById("dailyForecast");
    const hourlyForecast = document.getElementById("hourlyForecast");
    dailyForecast.innerHTML = "";
    hourlyForecast.innerHTML = "";

    data.list.forEach(entry => {
      const date = entry.dt_txt.split(" ")[0];
      const hour = entry.dt_txt.split(" ")[1].slice(0, 5);
      const icon = `https://openweathermap.org/img/wn/${entry.weather[0].icon}@2x.png`;

      if (!daily[date]) daily[date] = [];
      daily[date].push({ ...entry, hour, icon });
    });

    Object.keys(daily).forEach(date => {
      const items = daily[date];
      const dayAvg = (items.reduce((a, b) => a + b.main.temp, 0) / items.length).toFixed(1);
      const min = Math.min(...items.map(i => i.main.temp_min)).toFixed(1);
      const max = Math.max(...items.map(i => i.main.temp_max)).toFixed(1);
      const icon = items[0].icon;
      const desc = items[0].weather[0].description;

      const card = document.createElement("div");
      card.className = "day-card";
      card.innerHTML = `
        <div><strong>${toShamsi(date)}</strong></div>
        <img class="weather-icon" src="${icon}" />
        <div>${desc}</div>
        <div>ğŸŒ¡ï¸ ${min}Â°C ~ ${max}Â°C</div>
        <button onclick="toggleDetails('${date}')">ğŸ”½ Ø¬Ø²Ø¦ÛŒØ§Øª</button>
        <div id="details-${date}" class="hidden day-details">
          ${items.map(e => `
            <div>
              â° ${e.hour} | ${e.main.temp}Â°C | ${e.weather[0].description}<br>
              ğŸ’§ Ø±Ø·ÙˆØ¨Øª: ${e.main.humidity}% | ğŸ’¨ Ø¨Ø§Ø¯: ${e.wind.speed} m/s - Ø¬Ù‡Øª ${e.wind.deg}Â°<br>
              ğŸ”½ ÙØ´Ø§Ø±: ${e.main.pressure} hPa
            </div><hr>
          `).join("")}
        </div>
      `;
      dailyForecast.appendChild(card);
    });
  }

  function toggleDetails(id) {
    const el = document.getElementById("details-" + id);
    el.classList.toggle("hidden");
  }

  window.onload = () => {
    document.getElementById("cityInput").value = "Ø§Ù‡ÙˆØ§Ø²";
    searchCity();
  };
</script>
</body>
</html>
