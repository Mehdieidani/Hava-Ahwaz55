<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>پیش‌بینی دقیق هواشناسی</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background-color: #121212;
      color: #fff;
      margin: 0;
      padding: 20px;
      direction: rtl;
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 10px;
    }
    #forecast, #dailyForecast {
      margin-top: 20px;
    }
    .hour-card {
      border: 1px solid #444;
      border-radius: 10px;
      padding: 10px;
      margin: 10px 0;
      background-color: #1f1f1f;
      text-align: center;
    }
    .collapsible {
      background-color: #333;
      color: white;
      cursor: pointer;
      padding: 12px;
      width: 100%;
      border: none;
      text-align: right;
      outline: none;
      font-size: 16px;
      border-radius: 6px;
      margin-top: 10px;
    }
    .active, .collapsible:hover {
      background-color: #555;
    }
    .content {
      padding: 0 15px;
      display: none;
      overflow: hidden;
      background-color: #1f1f1f;
      border-radius: 6px;
    }
    footer {
      text-align: center;
      padding: 10px;
      font-size: 12px;
      color: #888;
    }
    select, button {
      font-size: 14px;
      margin: 5px;
      padding: 8px;
      border-radius: 6px;
      border: none;
    }
    .lang-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 999;
    }
  </style>
</head>
<body>
  <button class="lang-btn" onclick="switchLanguage()">🌐</button>
  <h1 id="title">پیش‌بینی دقیق هواشناسی</h1>

  <div>
    <input type="text" id="cityInput" placeholder="نام شهر را وارد کنید..." onkeypress="if(event.key==='Enter') getWeather()">
    <button onclick="getWeather()">نمایش آب‌وهوا</button>
  </div>

  <div id="forecast"></div>
  <div id="dailyForecast"></div>

  <footer>حقوق مادی و معنوی محفوظ است © Mehdi Eidani</footer>

  <script>
    let lang = "fa"; // fa or ar
    const apiKey = "dc9c93f51cdd375d459483c2a9f86d88";

    function switchLanguage() {
      lang = lang === "fa" ? "ar" : "fa";
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === "fa" ? "rtl" : "rtl";

      document.getElementById("title").innerText =
        lang === "fa" ? "پیش‌بینی دقیق هواشناسی" : "توقعات الطقس الدقيقة";
      document.getElementById("cityInput").placeholder =
        lang === "fa" ? "نام شهر را وارد کنید..." : "أدخل اسم المدينة...";
      document.querySelector("button[onclick='getWeather()']").innerText =
        lang === "fa" ? "نمایش آب‌وهوا" : "عرض الطقس";

      const city = document.getElementById("cityInput").value;
      if (city) getWeather();
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      if (lang === "fa") {
        return new Intl.DateTimeFormat("fa-IR", {
          weekday: "long", year: "numeric", month: "long", day: "numeric"
        }).format(date);
      } else {
        return new Intl.DateTimeFormat("ar-EG", {
          weekday: "long", year: "numeric", month: "long", day: "numeric"
        }).format(date);
      }
    }

    async function getWeather() {
      const city = document.getElementById("cityInput").value || "اهواز";
      const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&lang=${lang}&units=metric&appid=${apiKey}`);
      const data = await response.json();

      if (data.cod !== "200") {
        document.getElementById("forecast").innerHTML =
          lang === "fa" ? "خطا در دریافت اطلاعات، لطفاً دوباره تلاش کنید" : "حدث خطأ في جلب البيانات، الرجاء المحاولة مرة أخرى.";
        document.getElementById("dailyForecast").innerHTML = "";
        return;
      }

      document.getElementById("forecast").innerHTML = `<h2>${city}</h2>`;

      displayForecast(data);
    }

    function displayForecast(data) {
      const forecastDiv = document.getElementById("dailyForecast");
      forecastDiv.innerHTML = "";

      const days = {};
      data.list.forEach(item => {
        const date = item.dt_txt.split(" ")[0];
        if (!days[date]) days[date] = [];
        days[date].push(item);
      });

      for (const date in days) {
        const dayData = days[date];
        const minTemp = Math.min(...dayData.map(d => d.main.temp_min)).toFixed(1);
        const maxTemp = Math.max(...dayData.map(d => d.main.temp_max)).toFixed(1);
        const desc = dayData[0].weather[0].description;

        let hourHtml = "";
        dayData.forEach(h => {
          hourHtml += `
            <div class="hour-card">
              <div><strong>${h.dt_txt.split(" ")[1].slice(0, 5)}</strong></div>
              <img src="https://openweathermap.org/img/wn/${h.weather[0].icon}@2x.png" />
              <div>${h.weather[0].description}</div>
              <div>🌡 دما: ${h.main.temp}°C</div>
              <div>💧 رطوبت: ${h.main.humidity}%</div>
              <div>💨 باد: ${h.wind.speed} m/s</div>
              <div>🧭 جهت: ${h.wind.deg}°</div>
              <div>📉 فشار: ${h.main.pressure} hPa</div>
            </div>
          `;
        });

        forecastDiv.innerHTML += `
          <button class="collapsible">📅 ${formatDate(date)} | 🌤 ${desc} | 🔺 ${maxTemp}° | 🔻 ${minTemp}°</button>
          <div class="content"><div class="hourly-details">${hourHtml}</div></div>
        `;
      }

      const coll = document.getElementsByClassName("collapsible");
      for (let i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function () {
          this.classList.toggle("active");
          const content = this.nextElementSibling;
          content.style.display = content.style.display === "block" ? "none" : "block";
        });
      }
    }

    // پیش‌نمایش شهر اهواز هنگام بارگذاری
    window.onload = () => {
      document.getElementById("cityInput").value = "اهواز";
      getWeather();
    }
  </script>
</body>
</html>
