<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ŸáŸàÿßÿ¥ŸÜÿßÿ≥€å ÿ≠ÿ±ŸÅŸá‚Äåÿß€å</title>
<link href="https://cdn.jsdelivr.net/npm/vazir-font@v1.1.2/dist/font-face.css" rel="stylesheet" />
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  crossorigin=""
/>
<style>
  body {
    font-family: Vazir, sans-serif;
    margin: 0;
    background: linear-gradient(to top, #001529, #0a2749);
    color: #eee;
    direction: rtl;
  }
  header {
    background-color: #003366;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header h1 {
    margin: 0;
    font-weight: 700;
    font-size: 1.8rem;
  }
  #langToggle {
    background: #00509e;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 0.5rem 1rem;
    cursor: pointer;
    font-weight: bold;
  }
  main {
    display: flex;
    flex-wrap: wrap;
    padding: 1rem;
    gap: 1rem;
  }
  #leftPanel {
    flex: 1 1 320px;
    max-width: 400px;
    background: #013a63;
    border-radius: 12px;
    padding: 1rem;
  }
  #searchSection {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  #cityInput {
    flex: 1;
    padding: 0.6rem 0.8rem;
    border-radius: 6px;
    border: none;
    font-size: 1rem;
  }
  #searchBtn {
    background: #00509e;
    color: white;
    border: none;
    padding: 0 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  #favorites {
    margin-bottom: 1rem;
  }
  #favorites button {
    background: #00509e;
    color: white;
    border: none;
    margin: 0 0.2rem 0.2rem 0.2rem;
    padding: 0.4rem 0.8rem;
    border-radius: 8px;
    cursor: pointer;
  }
  #favorites button:hover {
    background: #1a73e8;
  }
  #currentWeather {
    background: #01497c;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1rem;
    text-align: center;
  }
  #currentWeather img {
    width: 100px;
    height: 100px;
  }
  #currentWeather h2 {
    margin: 0.5rem 0;
  }
  #currentWeather .temp {
    font-size: 2.8rem;
    font-weight: 700;
  }
  #currentWeather .desc {
    font-size: 1.2rem;
    margin: 0.5rem 0;
  }
  #currentWeather .details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.7rem;
    margin-top: 1rem;
    font-size: 0.9rem;
  }
  #forecastContainer {
    background: #013a63;
    flex: 2 1 600px;
    border-radius: 12px;
    padding: 1rem;
  }
  #dailyForecast {
    display: flex;
    gap: 0.7rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
  }
  .day-card {
    background: #00509e;
    flex: 0 0 120px;
    border-radius: 10px;
    padding: 0.5rem;
    cursor: pointer;
    user-select: none;
    transition: background 0.3s;
  }
  .day-card.active,
  .day-card:hover {
    background: #1a73e8;
  }
  .day-card h3 {
    margin: 0;
    font-size: 1rem;
    text-align: center;
  }
  .day-card img {
    display: block;
    margin: 0.3rem auto;
    width: 60px;
    height: 60px;
  }
  .day-card .temp {
    font-size: 1.2rem;
    text-align: center;
    font-weight: 700;
  }
  #hourlyForecast {
    margin-top: 1rem;
    max-height: 320px;
    overflow-y: auto;
    background: #01497c;
    border-radius: 12px;
    padding: 1rem;
  }
  .hour-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.8rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #0277bd;
  }
  .hour-card img {
    width: 48px;
    height: 48px;
  }
  .hour-info {
    flex: 1;
  }
  .hour-info div {
    margin-bottom: 0.2rem;
  }
  .detail-label {
    font-weight: 700;
  }
  #map {
    height: 300px;
    border-radius: 12px;
    margin-top: 1rem;
  }
  footer {
    text-align: center;
    padding: 1rem;
    font-size: 0.9rem;
    background: #002143;
    color: #bbb;
  }
  footer a {
    color: #3399ff;
    text-decoration: none;
    margin: 0 0.5rem;
  }
  footer a:hover {
    text-decoration: underline;
  }
  /* Scrollbar for daily forecast */
  #dailyForecast::-webkit-scrollbar {
    height: 8px;
  }
  #dailyForecast::-webkit-scrollbar-thumb {
    background: #3399ff;
    border-radius: 10px;
  }
  #dailyForecast::-webkit-scrollbar-track {
    background: #013a63;
  }
  /* Scrollbar for hourly forecast */
  #hourlyForecast::-webkit-scrollbar {
    width: 8px;
  }
  #hourlyForecast::-webkit-scrollbar-thumb {
    background: #3399ff;
    border-radius: 10px;
  }
  #hourlyForecast::-webkit-scrollbar-track {
    background: #013a63;
  }
</style>
</head>
<body>

<header>
  <h1 id="title">Ÿàÿ∂ÿπ€åÿ™ ÿ¢ÿ®‚ÄåŸàŸáŸàÿß</h1>
  <button id="langToggle" onclick="toggleLang()">AR</button>
</header>

<main>
  <section id="leftPanel">
    <div id="searchSection">
      <input id="cityInput" type="text" placeholder="ŸÜÿßŸÖ ÿ¥Ÿáÿ± €åÿß ÿ±Ÿàÿ≥ÿ™ÿß (ŸÖÿ´ŸÑÿßŸã ÿßŸáŸàÿßÿ≤ €åÿß Kazemi Do)" />
      <button id="searchBtn" onclick="searchCity()">ÿ¨ÿ≥ÿ™ÿ¨Ÿà</button>
    </div>
    <div id="favorites"></div>
    <div id="currentWeather"></div>
  </section>

  <section id="forecastContainer">
    <div id="dailyForecast"></div>
    <div id="hourlyForecast"></div>
    <div id="map"></div>
  </section>
</main>

<footer>
  <div>ÿ™ŸÖÿßÿ≥: <a href="tel:09332356547">09332356547</a></div>
  <div>ÿß€åŸÜÿ≥ÿ™ÿß⁄Øÿ±ÿßŸÖ: <a href="https://instagram.com/mehdi.eidani" target="_blank">@mehdi.eidani</a></div>
  <div>ÿß€åŸÖ€åŸÑ: <a href="mailto:mehdi1eidani@gmail.com">mehdi1eidani@gmail.com</a></div>
</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  crossorigin="">
</script>
<script>
  const API_KEY = "dc9c93f51cdd375d459483c2a9f86d88";
  let currentLang = "fa";
  let currentUnits = "metric";
  let currentCity = null;
  let map, mapMarker;

  const labels = {
    fa: {
      title: "Ÿàÿ∂ÿπ€åÿ™ ÿ¢ÿ®‚ÄåŸàŸáŸàÿß",
      searchPlaceholder: "ŸÜÿßŸÖ ÿ¥Ÿáÿ± €åÿß ÿ±Ÿàÿ≥ÿ™ÿß (ŸÖÿ´ŸÑÿßŸã ÿßŸáŸàÿßÿ≤ €åÿß Kazemi Do)",
      searchBtn: "ÿ¨ÿ≥ÿ™ÿ¨Ÿà",
      hourlyTitle: "Ÿæ€åÿ¥‚Äåÿ®€åŸÜ€å ÿ≥ÿßÿπÿ™€å",
      temp: "ÿØŸÖÿß",
      humidity: "ÿ±ÿ∑Ÿàÿ®ÿ™",
      pressure: "ŸÅÿ¥ÿßÿ± ŸáŸàÿß",
      windSpeed: "ÿ≥ÿ±ÿπÿ™ ÿ®ÿßÿØ",
      windDir: "ÿ¨Ÿáÿ™ ÿ®ÿßÿØ",
      sunrise: "ÿ∑ŸÑŸàÿπ ÿ¢ŸÅÿ™ÿßÿ®",
      sunset: "ÿ∫ÿ±Ÿàÿ® ÿ¢ŸÅÿ™ÿßÿ®",
      aqi: "⁄©€åŸÅ€åÿ™ ŸáŸàÿß",
      favoritesTitle: "ÿ¥Ÿáÿ±Ÿáÿß€å ŸÖŸàÿ±ÿØ ÿπŸÑÿßŸÇŸá",
      addFav: "ÿßŸÅÿ≤ŸàÿØŸÜ ÿ®Ÿá ÿπŸÑÿßŸÇŸá‚ÄåŸÖŸÜÿØ€å‚ÄåŸáÿß",
      removeFav: "ÿ≠ÿ∞ŸÅ ÿßÿ≤ ÿπŸÑÿßŸÇŸá‚ÄåŸÖŸÜÿØ€å‚ÄåŸáÿß",
      noFav: "ÿ¥Ÿáÿ± ŸÖŸàÿ±ÿØ ÿπŸÑÿßŸÇŸá Ÿàÿ¨ŸàÿØ ŸÜÿØÿßÿ±ÿØ.",
      errorCity: "ÿ¥Ÿáÿ± ŸÖŸàÿ±ÿØ ŸÜÿ∏ÿ± Ÿæ€åÿØÿß ŸÜÿ¥ÿØ.",
      callText: "üìû ÿ™ŸÖÿßÿ≥ ÿ®ÿß 09332356547",
      instagram: "ÿß€åŸÜÿ≥ÿ™ÿß⁄Øÿ±ÿßŸÖ",
      email: "ÿß€åŸÖ€åŸÑ",
      visibility: "ÿØ€åÿØ ÿßŸÅŸÇ€å",
      uvIndex: "ÿ¥ÿßÿÆÿµ UV",
      pop: "ÿßÿ≠ÿ™ŸÖÿßŸÑ ÿ®ÿßÿ±ÿ¥",
      feelsLike: "ÿßÿ≠ÿ≥ÿßÿ≥ ŸàÿßŸÇÿπ€å",
      dewPoint: "ŸÜŸÇÿ∑Ÿá ÿ¥ÿ®ŸÜŸÖ",
      clouds: "ÿßÿ®ÿ±Ÿáÿß",
      description: "ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™",
    },
    ar: {
      title: "ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÇÿ≥",
      searchPlaceholder: "ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿØŸäŸÜÿ© ÿ£Ÿà ÿßŸÑŸÇÿ±Ÿäÿ©",
      searchBtn: "ÿ®ÿ≠ÿ´",
      hourlyTitle: "ÿ™ŸàŸÇÿπÿßÿ™ ŸÉŸÑ ÿ≥ÿßÿπÿ©",
      temp: "ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ≠ÿ±ÿßÿ±ÿ©",
      humidity: "ÿßŸÑÿ±ÿ∑Ÿàÿ®ÿ©",
      pressure: "ÿßŸÑÿ∂ÿ∫ÿ∑ ÿßŸÑÿ¨ŸàŸä",
      windSpeed: "ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ±Ÿäÿßÿ≠",
      windDir: "ÿßÿ™ÿ¨ÿßŸá ÿßŸÑÿ±Ÿäÿßÿ≠",
      sunrise: "ÿ¥ÿ±ŸàŸÇ ÿßŸÑÿ¥ŸÖÿ≥",
      sunset: "ÿ∫ÿ±Ÿàÿ® ÿßŸÑÿ¥ŸÖÿ≥",
      aqi: "ÿ¨ŸàÿØÿ© ÿßŸÑŸáŸàÿßÿ°",
      favoritesTitle: "ÿßŸÑŸÖÿØŸÜ ÿßŸÑŸÖŸÅÿ∂ŸÑÿ©",
      addFav: "ÿ£ÿ∂ŸÅ ŸÑŸÑŸÖŸÅÿ∂ŸÑÿßÿ™",
      removeFav: "ÿ≠ÿ∞ŸÅ ŸÖŸÜ ÿßŸÑŸÖŸÅÿ∂ŸÑÿßÿ™",
      noFav: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿØŸÜ ŸÖŸÅÿ∂ŸÑÿ©.",
      errorCity: "ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖÿØŸäŸÜÿ©.",
      callText: "üìû ÿßÿ™ÿµŸÑ ÿ®ŸÄ 09332356547",
      instagram: "ÿßŸÜÿ≥ÿ™ÿ∫ÿ±ÿßŸÖ",
      email: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä",
      visibility: "ÿßŸÑÿ±ÿ§Ÿäÿ© ÿßŸÑÿ£ŸÅŸÇŸäÿ©",
      uvIndex: "ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ£ÿ¥ÿπÿ© ŸÅŸàŸÇ ÿßŸÑÿ®ŸÜŸÅÿ≥ÿ¨Ÿäÿ©",
      pop: "ÿßÿ≠ÿ™ŸÖÿßŸÑ Ÿáÿ∑ŸàŸÑ ÿßŸÑÿ£ŸÖÿ∑ÿßÿ±",
      feelsLike: "ÿßŸÑÿ≠ÿ±ÿßÿ±ÿ© ÿßŸÑŸÖÿ≠ÿ≥Ÿàÿ≥ÿ©",
      dewPoint: "ŸÜŸÇÿ∑ÿ© ÿßŸÑŸÜÿØŸâ",
      clouds: "ÿßŸÑÿ∫ŸäŸàŸÖ",
      description: "ÿßŸÑŸàÿµŸÅ",
    }
  };

  let favorites = JSON.parse(localStorage.getItem("favorites_weather")) || [];

  function toggleLang() {
    currentLang = currentLang === "fa" ? "ar" : "fa";
    document.getElementById("title").innerText = labels[currentLang].title;
    document.getElementById("cityInput").placeholder = labels[currentLang].searchPlaceholder;
    document.getElementById("searchBtn").innerText = labels[currentLang].searchBtn;
    renderFavorites();
    renderCurrentWeather(currentCity);
  }

  function toggleFavorite(cityName) {
    if (favorites.includes(cityName)) {
      favorites = favorites.filter(c => c !== cityName);
    } else {
      favorites.push(cityName);
    }
    localStorage.setItem("favorites_weather", JSON.stringify(favorites));
    renderFavorites();
  }

  function renderFavorites() {
    const favDiv = document.getElementById("favorites");
    favDiv.innerHTML = "";
    if (favorites.length === 0) {
      favDiv.innerText = labels[currentLang].noFav;
      return;
    }
    favorites.forEach(city => {
      const btn = document.createElement("button");
      btn.textContent = city;
      btn.onclick = () => {
        document.getElementById("cityInput").value = city;
        searchCity();
      };
      favDiv.appendChild(btn);
    });
  }

  async function searchCity() {
    const city = document.getElementById("cityInput").value.trim();
    if (!city) return alert(labels[currentLang].errorCity);

    try {
      const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(city)}&limit=1&appid=${API_KEY}`);
      const geoData = await geoRes.json();
      if (!geoData.length) return alert(labels[currentLang].errorCity);

      const { lat, lon, name, country } = geoData[0];
      currentCity = { lat, lon, name, country };

      if (!map) initMap(lat, lon);
      else {
        map.setView([lat, lon], 10);
        if (mapMarker) map.removeLayer(mapMarker);
        mapMarker = L.marker([lat, lon]).addTo(map).bindPopup(`${name}, ${country}`).openPopup();
      }

      const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=${currentUnits}&lang=${currentLang}&appid=${API_KEY}`);
      const weatherData = await weatherRes.json();

      const currentRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=${currentUnits}&lang=${currentLang}&appid=${API_KEY}`);
      const currentData = await currentRes.json();

      const aqiRes = await fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${API_KEY}`);
      const aqiData = await aqiRes.json();

      renderCurrentWeather(currentData, aqiData);
      renderForecast(weatherData);
    } catch (e) {
      alert("ÿÆÿ∑ÿß ÿØÿ± ÿØÿ±€åÿßŸÅÿ™ ÿØÿßÿØŸá‚ÄåŸáÿß. ŸÑÿ∑ŸÅÿß ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.");
      console.error(e);
    }
  }

  function degToDirection(deg) {
    const directionsFa = ["ÿ¥ŸÖÿßŸÑ", "ÿ¥ŸÖÿßŸÑ‚Äåÿ¥ÿ±ŸÇ", "ÿ¥ÿ±ŸÇ", "ÿ¨ŸÜŸàÿ®‚Äåÿ¥ÿ±ŸÇ", "ÿ¨ŸÜŸàÿ®", "ÿ¨ŸÜŸàÿ®‚Äåÿ∫ÿ±ÿ®", "ÿ∫ÿ±ÿ®", "ÿ¥ŸÖÿßŸÑ‚Äåÿ∫ÿ±ÿ®"];
    const directionsAr = ["ÿ¥ŸÖÿßŸÑ", "ÿ¥ŸÖÿßŸÑ ÿ¥ÿ±ŸÇŸä", "ÿ¥ÿ±ŸÇ", "ÿ¨ŸÜŸàÿ® ÿ¥ÿ±ŸÇŸä", "ÿ¨ŸÜŸàÿ®", "ÿ¨ŸÜŸàÿ® ÿ∫ÿ±ÿ®Ÿä", "ÿ∫ÿ±ÿ®", "ÿ¥ŸÖÿßŸÑ ÿ∫ÿ±ÿ®Ÿä"];
    const directions = currentLang === "fa" ? directionsFa : directionsAr;
    const index = Math.round(deg / 45) % 8;
    return directions[index];
  }

  function renderCurrentWeather(currentData, aqiData) {
    if (!currentData) return;
    const container = document.getElementById("currentWeather");
    container.innerHTML = "";

    const cityName = `${currentData.name}, ${currentData.sys.country}`;
    const iconUrl = `https://openweathermap.org/img/wn/${currentData.weather[0].icon}@4x.png`;
    const desc = currentData.weather[0].description;
    const temp = currentData.main.temp.toFixed(1);
    const humidity = currentData.main.humidity;
    const pressure = currentData.main.pressure;
    const windSpeed = currentData.wind.speed.toFixed(1);
    const windDeg = currentData.wind.deg;
    const visibility = currentData.visibility / 1000;
    const sunrise = new Date(currentData.sys.sunrise * 1000);
    const sunset = new Date(currentData.sys.sunset * 1000);
    const sunriseStr = sunrise.toLocaleTimeString(currentLang === "fa" ? "fa-IR" : "ar-EG", {hour: "2-digit", minute: "2-digit"});
    const sunsetStr = sunset.toLocaleTimeString(currentLang === "fa" ? "fa-IR" : "ar-EG", {hour: "2-digit", minute: "2-digit"});

    let aqiText = "";
    let aqiColor = "";
    if (aqiData && aqiData.list && aqiData.list.length) {
      const aqi = aqiData.list[0].main.aqi;
      switch (aqi) {
        case 1: aqiText = currentLang === "fa" ? "ÿÆŸàÿ®" : "ÿ¨ŸäÿØ"; aqiColor = "green"; break;
        case 2: aqiText = currentLang === "fa" ? "ŸÖÿπŸÖŸàŸÑ€å" : "ŸÖÿ™Ÿàÿ≥ÿ∑"; aqiColor = "yellow"; break;
        case 3: aqiText = currentLang === "ŸÅÿß" ? "ŸÜÿßÿ≥ÿßŸÑŸÖ ÿ®ÿ±ÿß€å ⁄Øÿ±ŸàŸá‚ÄåŸáÿß€å ÿ≠ÿ≥ÿßÿ≥" : "ÿ∫Ÿäÿ± ÿµÿ≠Ÿä ŸÑŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ≥ÿ©"; aqiColor = "orange"; break;
        case 4: aqiText = currentLang === "fa" ? "ŸÜÿßÿ≥ÿßŸÑŸÖ" : "ÿ∫Ÿäÿ± ÿµÿ≠Ÿä"; aqiColor = "red"; break;
        case 5: aqiText = currentLang === "fa" ? "ÿ®ÿ≥€åÿßÿ± ŸÜÿßÿ≥ÿßŸÑŸÖ" : "ÿ≥Ÿäÿ° ÿ¨ÿØÿß"; aqiColor = "purple"; break;
      }
    }

    const feelsLike = currentData.main.feels_like.toFixed(1);
    const dewPoint = (currentData.main.temp - ((100 - humidity) / 5)).toFixed(1);
    const clouds = currentData.clouds.all;

    container.innerHTML = `
      <h2>${cityName}</h2>
      <img src="${iconUrl}" alt="${desc}" />
      <div class="temp">${temp} ¬∞C</div>
      <div class="desc">${desc}</div>
      <div class="details">
        <div><strong>${labels[currentLang].humidity}:</strong> ${humidity}%</div>
        <div><strong>${labels[currentLang].pressure}:</strong> ${pressure} hPa</div>
        <div><strong>${labels[currentLang].windSpeed}:</strong> ${windSpeed} m/s</div>
        <div><strong>${labels[currentLang].windDir}:</strong> ${degToDirection(windDeg)}</div>
        <div><strong>${labels[currentLang].visibility}:</strong> ${visibility} km</div>
        <div><strong>${labels[currentLang].sunrise}:</strong> ${sunriseStr}</div>
        <div><strong>${labels[currentLang].sunset}:</strong> ${sunsetStr}</div>
        <div><strong>${labels[currentLang].aqi}:</strong> <span style="color:${aqiColor}">${aqiText}</span></div>
        <div><strong>${labels[currentLang].feelsLike}:</strong> ${feelsLike} ¬∞C</div>
        <div><strong>${labels[currentLang].dewPoint}:</strong> ${dewPoint} ¬∞C</div>
        <div><strong>${labels[currentLang].clouds}:</strong> ${clouds}%</div>
      </div>
      <button onclick="toggleFavorite('${currentData.name}')">
        ${favorites.includes(currentData.name) ? labels[currentLang].removeFav : labels[currentLang].addFav}
      </button>
    `;
  }

  function renderForecast(weatherData) {
    if (!weatherData) return;
    // Ÿæ€åÿ¥‚Äåÿ®€åŸÜ€å ÿ±Ÿàÿ≤ÿßŸÜŸá (ÿ™ŸÇÿ≥€åŸÖ ÿ®ŸÜÿØ€å Ÿáÿ± 8 ÿØÿßÿØŸá Ÿáÿ± 24 ÿ≥ÿßÿπÿ™)
    const dailyDiv = document.getElementById("dailyForecast");
    dailyDiv.innerHTML = "";

    // ŸÖÿ±ÿ™ÿ® ⁄©ÿ±ÿØŸÜ Ÿà ÿ¨ÿØÿßÿ≥ÿßÿ≤€å ÿØÿßÿØŸá‚ÄåŸáÿß ÿ®Ÿá ÿ±Ÿàÿ≤Ÿáÿß
    let dailyData = {};
    weatherData.list.forEach(item => {
      const date = item.dt_txt.split(" ")[0];
      if (!dailyData[date]) dailyData[date] = [];
      dailyData[date].push(item);
    });

    // ÿß€åÿ¨ÿßÿØ ⁄©ÿßÿ±ÿ™‚ÄåŸáÿß€å ÿ±Ÿàÿ≤ÿßŸÜŸá
    let dayIndex = 0;
    for (const [date, items] of Object.entries(dailyData)) {
      if (dayIndex >= 5) break; // ŸÅŸÇÿ∑ 5 ÿ±Ÿàÿ≤ ÿ¢€åŸÜÿØŸá

      // ŸÖ€åÿßŸÜ⁄Ø€åŸÜ ÿØŸÖÿß Ÿà ÿ¢€å⁄©ŸàŸÜ ÿ±Ÿàÿ≤ÿßŸÜŸá
      const temps = items.map(i => i.main.temp);
      const avgTemp = (temps.reduce((a,b) => a+b, 0) / temps.length).toFixed(1);

      const icon = items[0].weather[0].icon;
      const desc = items[0].weather[0].description;

      const dayName = new Date(date).toLocaleDateString(currentLang === "fa" ? "fa-IR" : "ar-EG", { weekday: "short" });

      const card = document.createElement("div");
      card.className = "day-card";
      if(dayIndex === 0) card.classList.add("active");
      card.dataset.date = date;

      card.innerHTML = `
        <h3>${dayName}</h3>
        <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${desc}" />
        <div class="temp">${avgTemp} ¬∞C</div>
      `;

      card.onclick = () => renderHourly(date, dailyData[date]);

      dailyDiv.appendChild(card);
      dayIndex++;
    }

    // ÿ®Ÿá ÿ∑Ÿàÿ± Ÿæ€åÿ¥ ŸÅÿ±ÿ∂ ÿßŸàŸÑ€åŸÜ ÿ±Ÿàÿ≤ ÿßŸÜÿ™ÿÆÿßÿ® ÿ¥ÿØŸá Ÿà ÿ≥ÿßÿπÿ™‚ÄåŸáÿß ŸÜŸÖÿß€åÿ¥ ÿØÿßÿØŸá ÿ¥ŸàŸÜÿØ
    const firstDate = Object.keys(dailyData)[0];
    if(firstDate) renderHourly(firstDate, dailyData[firstDate]);
  }

  function renderHourly(date, hourlyList) {
    const hourlyDiv = document.getElementById("hourlyForecast");
    hourlyDiv.innerHTML = `<h3>${labels[currentLang].hourlyTitle} - ${new Date(date).toLocaleDateString(currentLang === "fa" ? "fa-IR" : "ar-EG")}</h3>`;
    hourlyList.forEach(hour => {
      const time = hour.dt_txt.split(" ")[1].slice(0,5);
      const icon = hour.weather[0].icon;
      const desc = hour.weather[0].description;
      const temp = hour.main.temp.toFixed(1);
      const windSpeed = hour.wind.speed.toFixed(1);
      const windDir = degToDirection(hour.wind.deg);

      const card = document.createElement("div");
      card.className = "hour-card";
      card.innerHTML = `
        <img src="https://openweathermap.org/img/wn/${icon}.png" alt="${desc}" />
        <div class="hour-info">
          <div><strong>${time}</strong></div>
          <div>${desc}</div>
          <div><strong>${labels[currentLang].temp}:</strong> ${temp} ¬∞C</div>
          <div><strong>${labels[currentLang].windSpeed}:</strong> ${windSpeed} m/s (${windDir})</div>
        </div>
      `;
      hourlyDiv.appendChild(card);
    });

    // ÿ™ÿ∫€å€åÿ± Ÿàÿ∂ÿπ€åÿ™ ŸÅÿπÿßŸÑ ⁄©ÿßÿ±ÿ™ ÿ±Ÿàÿ≤ÿßŸÜŸá
    document.querySelectorAll(".day-card").forEach(card => {
      card.classList.toggle("active", card.dataset.date === date);
    });
  }

  function initMap(lat, lon) {
    map = L.map("map").setView([lat, lon], 10);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution:
        '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);
    mapMarker = L.marker([lat, lon]).addTo(map);
  }

  // ÿµŸÅÿ≠Ÿá ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿßŸàŸÑ€åŸá
  window.onload = () => {
    renderFavorites();
    document.getElementById("cityInput").placeholder = labels[currentLang].searchPlaceholder;
  };
</script>

</body>
</html>
