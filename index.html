<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¯Ù‚ÛŒÙ‚ Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background-color: #121212;
      color: #fff;
      margin: 0;
      padding: 20px;
      direction: rtl;
    }
    h1, h2 {
      text-align: center;
      margin-bottom: 10px;
    }
    #forecast, #dailyForecast {
      margin-top: 20px;
    }
    .hour-card {
      border: 1px solid #444;
      border-radius: 10px;
      padding: 10px;
      margin: 10px 0;
      background-color: #1f1f1f;
      text-align: center;
    }
    .collapsible {
      background-color: #333;
      color: white;
      cursor: pointer;
      padding: 12px;
      width: 100%;
      border: none;
      text-align: right;
      outline: none;
      font-size: 16px;
      border-radius: 6px;
      margin-top: 10px;
    }
    .active, .collapsible:hover {
      background-color: #555;
    }
    .content {
      padding: 0 15px;
      display: none;
      overflow: hidden;
      background-color: #1f1f1f;
      border-radius: 6px;
    }
    footer {
      text-align: center;
      padding: 10px;
      font-size: 12px;
      color: #888;
    }
    select, button {
      font-size: 14px;
      margin: 5px;
      padding: 8px;
      border-radius: 6px;
      border: none;
    }
    .lang-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 999;
    }
  </style>
</head>
<body>
  <button class="lang-btn" onclick="switchLanguage()">ğŸŒ</button>
  <h1 id="title">Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¯Ù‚ÛŒÙ‚ Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ</h1>

  <div>
    <input type="text" id="cityInput" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." onkeypress="if(event.key==='Enter') getWeather()">
    <button onclick="getWeather()">Ù†Ù…Ø§ÛŒØ´ Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§</button>
  </div>

  <div id="forecast"></div>
  <div id="dailyForecast"></div>

  <footer>Ø­Ù‚ÙˆÙ‚ Ù…Ø§Ø¯ÛŒ Ùˆ Ù…Ø¹Ù†ÙˆÛŒ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª Â© Mehdi Eidani</footer>

  <script>
    let lang = "fa"; // fa or ar
    const apiKey = "dc9c93f51cdd375d459483c2a9f86d88";

    function switchLanguage() {
      lang = lang === "fa" ? "ar" : "fa";
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === "fa" ? "rtl" : "rtl";

      document.getElementById("title").innerText =
        lang === "fa" ? "Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¯Ù‚ÛŒÙ‚ Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ" : "ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©";
      document.getElementById("cityInput").placeholder =
        lang === "fa" ? "Ù†Ø§Ù… Ø´Ù‡Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." : "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©...";
      document.querySelector("button[onclick='getWeather()']").innerText =
        lang === "fa" ? "Ù†Ù…Ø§ÛŒØ´ Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§" : "Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù‚Ø³";

      const city = document.getElementById("cityInput").value;
      if (city) getWeather();
    }

    function formatDate(dateStr) {
      const date = new Date(dateStr);
      if (lang === "fa") {
        return new Intl.DateTimeFormat("fa-IR", {
          weekday: "long", year: "numeric", month: "long", day: "numeric"
        }).format(date);
      } else {
        return new Intl.DateTimeFormat("ar-EG", {
          weekday: "long", year: "numeric", month: "long", day: "numeric"
        }).format(date);
      }
    }

    async function getWeather() {
      const city = document.getElementById("cityInput").value || "Ø§Ù‡ÙˆØ§Ø²";
      const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&lang=${lang}&units=metric&appid=${apiKey}`);
      const data = await response.json();

      if (data.cod !== "200") {
        document.getElementById("forecast").innerHTML =
          lang === "fa" ? "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§ØªØŒ Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯" : "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
        document.getElementById("dailyForecast").innerHTML = "";
        return;
      }

      document.getElementById("forecast").innerHTML = `<h2>${city}</h2>`;

      displayForecast(data);
    }

    function displayForecast(data) {
      const forecastDiv = document.getElementById("dailyForecast");
      forecastDiv.innerHTML = "";

      const days = {};
      data.list.forEach(item => {
        const date = item.dt_txt.split(" ")[0];
        if (!days[date]) days[date] = [];
        days[date].push(item);
      });

      for (const date in days) {
        const dayData = days[date];
        const minTemp = Math.min(...dayData.map(d => d.main.temp_min)).toFixed(1);
        const maxTemp = Math.max(...dayData.map(d => d.main.temp_max)).toFixed(1);
        const desc = dayData[0].weather[0].description;

        let hourHtml = "";
        dayData.forEach(h => {
          hourHtml += `
            <div class="hour-card">
              <div><strong>${h.dt_txt.split(" ")[1].slice(0, 5)}</strong></div>
              <img src="https://openweathermap.org/img/wn/${h.weather[0].icon}@2x.png" />
              <div>${h.weather[0].description}</div>
              <div>ğŸŒ¡ Ø¯Ù…Ø§: ${h.main.temp}Â°C</div>
              <div>ğŸ’§ Ø±Ø·ÙˆØ¨Øª: ${h.main.humidity}%</div>
              <div>ğŸ’¨ Ø¨Ø§Ø¯: ${h.wind.speed} m/s</div>
              <div>ğŸ§­ Ø¬Ù‡Øª: ${h.wind.deg}Â°</div>
              <div>ğŸ“‰ ÙØ´Ø§Ø±: ${h.main.pressure} hPa</div>
            </div>
          `;
        });

        forecastDiv.innerHTML += `
          <button class="collapsible">ğŸ“… ${formatDate(date)} | ğŸŒ¤ ${desc} | ğŸ”º ${maxTemp}Â° | ğŸ”» ${minTemp}Â°</button>
          <div class="content"><div class="hourly-details">${hourHtml}</div></div>
        `;
      }

      const coll = document.getElementsByClassName("collapsible");
      for (let i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function () {
          this.classList.toggle("active");
          const content = this.nextElementSibling;
          content.style.display = content.style.display === "block" ? "none" : "block";
        });
      }
    }

    // Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø´Ù‡Ø± Ø§Ù‡ÙˆØ§Ø² Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
    window.onload = () => {
      document.getElementById("cityInput").value = "Ø§Ù‡ÙˆØ§Ø²";
      getWeather();
    }
  </script>
</body>
</html>
