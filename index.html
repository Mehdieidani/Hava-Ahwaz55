<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
  <style>
    body {
      font-family: sans-serif;
      background: #0d1f2d;
      color: #eee;
      margin: 0;
      padding: 0;
      direction: rtl;
    }
    header {
      background: linear-gradient(to left, #0097a7, #00bcd4);
      padding: 1rem;
      text-align: center;
      font-size: 1.8rem;
      font-weight: bold;
      position: relative;
      color: white;
    }
    #language-toggle {
      position: absolute;
      left: 1rem;
      top: 1rem;
      background: #ff5722;
      border: none;
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    #search-container {
      padding: 1rem;
      text-align: center;
    }
    #searchInput {
      padding: 0.5rem;
      width: 70%;
      max-width: 400px;
      border-radius: 5px;
      border: none;
      font-size: 1rem;
    }
    #get-location {
      margin-left: 10px;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      border: none;
      background: #00bcd4;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    #forecast {
      max-width: 900px;
      margin: 1rem auto;
      padding: 0 1rem;
    }
    .day {
      background: #143447;
      border-radius: 10px;
      margin-bottom: 1rem;
      padding: 1rem;
      position: relative;
    }
    .star {
      position: absolute;
      top: 15px;
      left: 15px;
      font-size: 2rem;
      color: gold;
      user-select: none;
      cursor: pointer;
    }
    .day-section {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
      background: #1c476b;
      border-radius: 8px;
      padding: 0.7rem 1rem;
      align-items: center;
    }
    .day-section div {
      flex: 1;
      text-align: center;
      font-size: 1rem;
    }
    .weather-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto;
      display: block;
    }
    .favorite-btn {
      background: #00838f;
      border: none;
      padding: 0.4rem 1rem;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      margin-top: 0.5rem;
      font-weight: bold;
    }
    #comments-section {
      max-width: 900px;
      margin: 2rem auto;
      background: #252525;
      border-radius: 8px;
      padding: 1rem;
    }
    #commentInput {
      width: 100%;
      height: 80px;
      border-radius: 5px;
      border: none;
      padding: 0.5rem;
      resize: vertical;
      font-size: 1rem;
    }
    #submitComment {
      margin-top: 0.5rem;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      background: #00bcd4;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    #commentsContainer {
      margin-top: 1rem;
      max-height: 200px;
      overflow-y: auto;
    }
    .comment {
      background: #1a2a3a;
      padding: 0.6rem;
      border-radius: 5px;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      word-break: break-word;
    }
    footer {
      text-align: center;
      padding: 1rem;
      color: #bbb;
      background: #111;
      margin-top: 2rem;
    }
    a {
      color: #ffcc00;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <div id="header-title">Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§</div>
    <button id="language-toggle">AR</button>
  </header>

  <div id="search-container">
    <input type="text" id="searchInput" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." />
    <button id="get-location">ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†</button>
  </div>

  <div id="forecast"></div>

  <div id="comments-section">
    <h3 id="comments-title">Ù†Ø¸Ø±Ø§Øª Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª</h3>
    <textarea id="commentInput" placeholder="Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."></textarea>
    <br />
    <button id="submitComment">Ø§Ø±Ø³Ø§Ù„</button>
    <div id="commentsContainer"></div>
  </div>

  <footer>
    ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§: <a href="tel:09332356547">09332356547</a> |
    Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…: <a href="https://instagram.com/mehdi.eidani" target="_blank">@mehdi.eidani</a> |
    Ø§ÛŒÙ…ÛŒÙ„: <a href="mailto:mehdi1eidani@gmail.com">mehdi1eidani@gmail.com</a><br />
    ØªÙ…Ø§Ù… Ø­Ù‚ÙˆÙ‚ Ù…ØªØ¹Ù„Ù‚ Ø¨Ù‡ Mehdi Eidani Ø§Ø³Øª
  </footer>

  <script>
    const apiKey = "dc9c93f51cdd375d459483c2a9f86d88";

    const langToggle = document.getElementById("language-toggle");
    const headerTitle = document.getElementById("header-title");
    const searchInput = document.getElementById("searchInput");
    const forecastDiv = document.getElementById("forecast");
    const getLocationBtn = document.getElementById("get-location");
    const commentInput = document.getElementById("commentInput");
    const submitCommentBtn = document.getElementById("submitComment");
    const commentsContainer = document.getElementById("commentsContainer");
    const commentsTitle = document.getElementById("comments-title");

    let lang = "fa";

    const translations = {
      fa: {
        header: "Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§",
        placeholder: "Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...",
        locationBtn: "ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†",
        showHourly: "Ù†Ù…Ø§ÛŒØ´ Ø³Ø§Ø¹ØªÛŒ â–¼",
        hideHourly: "Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† â–²",
        commentsTitle: "Ù†Ø¸Ø±Ø§Øª Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª",
        commentPlaceholder: "Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...",
        sendBtn: "Ø§Ø±Ø³Ø§Ù„",
        alertEmptyComment: "Ù„Ø·ÙØ§ ÛŒÚ© Ù†Ø¸Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.",
        alertCommentSaved: "Ù†Ø¸Ø± Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯.",
        errorFetch: "â— Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§ØªØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",
        wind: "Ø¨Ø§Ø¯",
        tempMax: "Ø¯Ù…Ø§ÛŒ Ø¨ÛŒØ´ÛŒÙ†Ù‡ Ø±ÙˆØ²",
        tempMin: "Ø¯Ù…Ø§ÛŒ Ú©Ù…ÛŒÙ†Ù‡ Ø´Ø¨",
        favoriteAdded: "Ø´Ù‡Ø± Ø¨Ù‡ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.",
        favoriteRemoved: "Ø´Ù‡Ø± Ø§Ø² Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ø­Ø°Ù Ø´Ø¯.",
        humidity: "Ø±Ø·ÙˆØ¨Øª",
        pressure: "ÙØ´Ø§Ø±",
        status: "ÙˆØ¶Ø¹ÛŒØª",
        hour: "Ø³Ø§Ø¹Øª",
        temp: "Ø¯Ù…Ø§"
      },
      ar: {
        header: "ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø·Ù‚Ø³",
        placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ù‚Ø±ÙŠØ©...",
        locationBtn: "ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ",
        showHourly: "Ø¹Ø±Ø¶ ÙƒÙ„ Ø³Ø§Ø¹Ø© â–¼",
        hideHourly: "Ø¥Ø®ÙØ§Ø¡ â–²",
        commentsTitle: "Ø¢Ø±Ø§Ø¡ ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§Øª",
        commentPlaceholder: "Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§...",
        sendBtn: "Ø¥Ø±Ø³Ø§Ù„",
        alertEmptyComment: "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ¹Ù„ÙŠÙ‚.",
        alertCommentSaved: "ØªÙ… Ø­ÙØ¸ ØªØ¹Ù„ÙŠÙ‚Ùƒ.",
        errorFetch: "â— Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.",
        wind: "Ø§Ù„Ø±ÙŠØ§Ø­",
        tempMax: "Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù†Ù‡Ø§Ø± Ø§Ù„Ù‚ØµÙˆÙ‰",
        tempMin: "Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù„ÙŠÙ„ Ø§Ù„Ø¯Ù†ÙŠØ§",
        favoriteAdded: "ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù„Ù„Ù…ÙØ¶Ù„Ø©.",
        favoriteRemoved: "ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©.",
        humidity: "Ø§Ù„Ø±Ø·ÙˆØ¨Ø©",
        pressure: "Ø§Ù„Ø¶ØºØ·",
        status: "Ø§Ù„Ø­Ø§Ù„Ø©",
        hour: "Ø§Ù„Ø³Ø§Ø¹Ø©",
        temp: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©"
      }
    };

    function windDirection(deg) {
      const directions = lang === "fa"
        ? ["Ø´Ù…Ø§Ù„", "Ø´Ù…Ø§Ù„â€ŒØ´Ø±Ù‚", "Ø´Ø±Ù‚", "Ø¬Ù†ÙˆØ¨â€ŒØ´Ø±Ù‚", "Ø¬Ù†ÙˆØ¨", "Ø¬Ù†ÙˆØ¨â€ŒØºØ±Ø¨", "ØºØ±Ø¨", "Ø´Ù…Ø§Ù„â€ŒØºØ±Ø¨"]
        : ["Ø´Ù…Ø§Ù„", "Ø´Ù…Ø§Ù„ Ø´Ø±Ù‚", "Ø´Ø±Ù‚", "Ø¬Ù†ÙˆØ¨ Ø´Ø±Ù‚", "Ø¬Ù†ÙˆØ¨", "Ø¬Ù†ÙˆØ¨ ØºØ±Ø¨", "ØºØ±Ø¨", "Ø´Ù…Ø§Ù„ ØºØ±Ø¨"];
      return directions[Math.round(deg / 45) % 8];
    }

    function toggleLanguage() {
      lang = lang === "fa" ? "ar" : "fa";
      langToggle.textContent = lang === "fa" ? "AR" : "FA";
      headerTitle.textContent = translations[lang].header;
      searchInput.placeholder = translations[lang].placeholder;
      getLocationBtn.textContent = translations[lang].locationBtn;
      commentsTitle.textContent = translations[lang].commentsTitle;
      commentInput.placeholder = translations[lang].commentPlaceholder;
      submitCommentBtn.textContent = translations[lang].sendBtn;
      if (searchInput.value.trim() !== "") {
        fetchWeather(searchInput.value.trim());
      }
    }

    langToggle.addEventListener("click", toggleLanguage);

    function saveFavorite(city) {
      localStorage.setItem("fav_city_" + city.toLowerCase(), "1");
    }
    function removeFavorite(city) {
      localStorage.removeItem("fav_city_" + city.toLowerCase());
    }
    function isFavorite(city) {
      return localStorage.getItem("fav_city_" + city.toLowerCase()) === "1";
    }

    function toggleFavorite(city, starElement) {
      if (isFavorite(city)) {
        removeFavorite(city);
        starElement.textContent = "â˜†";
        alert(translations[lang].favoriteRemoved);
      } else {
        saveFavorite(city);
        starElement.textContent = "â˜…";
        alert(translations[lang].favoriteAdded);
      }
    }

    async function fetchWeather(city) {
      forecastDiv.innerHTML = lang === "fa" ? "Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª..." : "Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
      try {
        const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)}&appid=${apiKey}&units=metric&lang=${lang}`);
        const data = await res.json();
        if (!data.list || data.cod !== "200") throw new Error();
        searchInput.value = data.city.name;
        displayForecast(data.list, data.city.name);
      } catch {
        forecastDiv.innerHTML = translations[lang].errorFetch;
      }
    }

    function displayForecast(list, cityName) {
      // Ú¯Ø±ÙˆÙ‡ Ø¨Ù†Ø¯ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÙˆØ²
      const days = {};
      list.forEach(item => {
        const day = item.dt_txt.split(" ")[0];
        if (!days[day]) days[day] = [];
        days[day].push(item);
      });

      forecastDiv.innerHTML = "";

      const favStar = isFavorite(cityName) ? "â˜…" : "â˜†";

      // Ø³ØªØ§Ø±Ù‡ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ù„ Ø´Ù‡Ø±:
      const starDiv = document.createElement("div");
      starDiv.className = "star";
      starDiv.title = lang === "fa" ? "Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒ Ø´Ù‡Ø±" : "Ù…ÙØ¶Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©";
      starDiv.textContent = favStar;
      starDiv.addEventListener("click", () => toggleFavorite(cityName, starDiv));
      forecastDiv.appendChild(starDiv);

      Object.keys(days).slice(0, 5).forEach(day => {
        const dayItems = days[day];

        // Ø¨ÛŒØ´ÛŒÙ†Ù‡ Ø¯Ù…Ø§ Ø±ÙˆØ² (Ø­Ø¯ÙˆØ¯ 9 ØªØ§ 15 Ø¹ØµØ±)
        const dayTemps = dayItems.filter(item => {
          const hour = parseInt(item.dt_txt.split(" ")[1].slice(0,2));
          return hour >= 9 && hour <= 15;
        });

        // Ú©Ù…ÛŒÙ†Ù‡ Ø¯Ù…Ø§ Ø´Ø¨ (Ø­Ø¯ÙˆØ¯ 21 ØªØ§ 5 ØµØ¨Ø­)
        const nightTemps = dayItems.filter(item => {
          const hour = parseInt(item.dt_txt.split(" ")[1].slice(0,2));
          return hour >= 21 || hour <= 5;
        });

        const maxDayTempObj = dayTemps.reduce((prev, curr) => prev.main.temp_max > curr.main.temp_max ? prev : curr, dayTemps[0] || dayItems[0]);
        const minNightTempObj = nightTemps.reduce((prev, curr) => prev.main.temp_min < curr.main.temp_min ? prev : curr, nightTemps[0] || dayItems[0]);

        const dayDiv = document.createElement("div");
        dayDiv.className = "day";

        dayDiv.innerHTML = `
          <div><strong>${lang === "fa" ? "Ø±ÙˆØ²" : "Ø§Ù„ÙŠÙˆÙ…"}: ${day}</strong></div>

          <div class="day-section" title="${translations[lang].tempMax}">
            <div>${lang === "fa" ? "Ø±ÙˆØ² (Ø¨ÛŒØ´ÛŒÙ†Ù‡)" : "Ù†Ù‡Ø§Ø± (Ù‚ØµÙˆÙ‰)"}</div>
            <div>
              <img class="weather-icon" src="https://openweathermap.org/img/wn/${maxDayTempObj.weather[0].icon}@2x.png" alt="${maxDayTempObj.weather[0].description}" />
            </div>
            <div>${maxDayTempObj.main.temp_max.toFixed(1)}Â°C</div>
          </div>

          <div class="day-section" title="${translations[lang].tempMin}">
            <div>${lang === "fa" ? "Ø´Ø¨ (Ú©Ù…ÛŒÙ†Ù‡)" : "Ù„ÙŠÙ„ (Ø¯Ù†ÙŠØ§)"}</div>
            <div>
              <img class="weather-icon" src="https://openweathermap.org/img/wn/${minNightTempObj.weather[0].icon}@2x.png" alt="${minNightTempObj.weather[0].description}" />
            </div>
            <div>${minNightTempObj.main.temp_min.toFixed(1)}Â°C</div>
          </div>

          <button class="favorite-btn">${translations[lang].showHourly}</button>
          <div class="hourly" style="display:none;">
            ${dayItems.map(item => `
              <div>
                ${translations[lang].hour}: ${item.dt_txt.split(" ")[1].slice(0,5)} |
                ${translations[lang].temp}: ${item.main.temp.toFixed(1)}Â°C |
                ${translations[lang].humidity}: ${item.main.humidity}% |
                ${translations[lang].pressure}: ${item.main.pressure} hPa |
                ${translations[lang].wind}: ${item.wind.speed} km/h - ${windDirection(item.wind.deg)} |
                ${translations[lang].status}: ${item.weather[0].description}
              </div>
            `).join("")}
          </div>
        `;

        forecastDiv.appendChild(dayDiv);

        const toggleBtn = dayDiv.querySelector(".favorite-btn");
        const hourlyDiv = dayDiv.querySelector(".hourly");
        toggleBtn.addEventListener("click", () => {
          if (hourlyDiv.style.display === "block") {
            hourlyDiv.style.display = "none";
            toggleBtn.textContent = translations[lang].showHourly;
          } else {
            hourlyDiv.style.display = "block";
            toggleBtn.textContent = translations[lang].hideHourly;
          }
        });
      });
    }

    searchInput.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        const city = searchInput.value.trim();
        if (city) fetchWeather(city);
      }
    });

    getLocationBtn.addEventListener("click", () => {
      if (!navigator.geolocation) {
        alert(lang === "fa" ? "Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² GPS Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯." : "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… GPS.");
        return;
      }
      navigator.geolocation.getCurrentPosition(position => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
        fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=${lang}`)
          .then(res => res.json())
          .then(data => {
            if (!data.list) throw new Error();
            searchInput.value = data.city.name;
            displayForecast(data.list, data.city.name);
          })
          .catch(() => {
            alert(lang === "fa" ? "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª." : "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹.");
          });
      }, () => {
        alert(lang === "fa" ? "Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø±Ø¯ Ø´Ø¯." : "ØªÙ… Ø±ÙØ¶ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.");
      });
    });

    // Ø¨Ø®Ø´ Ù†Ø¸Ø±Ø§Øª Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª
    function loadComments() {
      const comments = JSON.parse(localStorage.getItem("comments") || "[]");
      commentsContainer.innerHTML = "";
      comments.forEach(c => {
        const div = document.createElement("div");
        div.className = "comment";
        div.textContent = c;
        commentsContainer.appendChild(div);
      });
    }

    submitCommentBtn.addEventListener("click", () => {
      const val = commentInput.value.trim();
      if (!val) {
        alert(translations[lang].alertEmptyComment);
        return;
      }
      const comments = JSON.parse(localStorage.getItem("comments") || "[]");
      comments.push(val);
      localStorage
