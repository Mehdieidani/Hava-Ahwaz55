<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>هواشناسی پیشرفته</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background: #121212;
      color: #fff;
      margin: 0;
      padding: 0;
      direction: rtl;
    }
    header, footer {
      text-align: center;
      padding: 10px;
      background-color: #1f1f1f;
    }
    .language-switch {
      position: absolute;
      left: 10px;
      top: 10px;
    }
    .search {
      margin: 10px;
      text-align: center;
    }
    .forecast {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .day-block {
      background: #1e1e1e;
      border-radius: 10px;
      padding: 10px;
      margin: 10px;
      width: 200px;
      text-align: center;
      cursor: pointer;
    }
    .hourly {
      display: none;
      background: #2b2b2b;
      border-radius: 10px;
      margin-top: 10px;
      padding: 5px;
    }
    .hourly-item {
      margin: 5px;
      border-bottom: 1px solid #444;
      padding: 5px;
    }
    .contact {
      background: #222;
      padding: 10px;
      text-align: center;
    }
    .contact a {
      color: #00c0ff;
      font-size: 18px;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="title">پیش‌بینی دقیق آب‌وهوا</h1>
    <div class="language-switch">
      <button onclick="setLang('fa')">🇮🇷 فارسی</button>
      <button onclick="setLang('ar')">🇸🇦 عربي</button>
    </div>
  </header>

  <div class="search">
    <input type="text" id="cityInput" placeholder="نام شهر را وارد کنید">
    <button onclick="fetchWeather()">جستجو</button>
  </div>

  <div id="forecast" class="forecast"></div>

  <div class="contact">
    <p>📞 <a href="tel:09332356547">تماس با ما: 09332356547</a></p>
    <p>📷 اینستاگرام: <a href="https://instagram.com/mehdi.eidani" target="_blank">@mehdi.eidani</a></p>
    <p>📧 ایمیل: <a href="mailto:mehdi1eidani@gmail.com">mehdi1eidani@gmail.com</a></p>
  </div>

  <footer>
    <p>حقوق Mehdi Eidani محفوظ است ©</p>
  </footer>

  <script>
    const apiKey = "dc9c93f51cdd375d459483c2a9f86d88";
    let lang = 'fa';

    function setLang(newLang) {
      lang = newLang;
      document.documentElement.lang = lang;
      document.documentElement.dir = (lang === 'ar' ? 'rtl' : 'rtl');
      document.getElementById("title").innerText = (lang === 'ar' ? 'توقعات الطقس الدقيقة' : 'پیش‌بینی دقیق آب‌وهوا');
      fetchWeather();
    }

    function fetchWeather() {
      const city = document.getElementById("cityInput").value || "اهواز";
      fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric&lang=${lang}`)
        .then(response => response.json())
        .then(data => {
          displayForecast(data);
        })
        .catch(err => {
          document.getElementById("forecast").innerHTML = `<p>⚠️ خطا در دریافت اطلاعات، لطفاً دوباره تلاش کنید.</p>`;
        });
    }

    function displayForecast(data) {
      const container = document.getElementById("forecast");
      container.innerHTML = "";
      const daily = {};

      data.list.forEach(item => {
        const date = item.dt_txt.split(" ")[0];
        if (!daily[date]) daily[date] = [];
        daily[date].push(item);
      });

      Object.keys(daily).slice(0, 5).forEach((date, index) => {
        const dayItems = daily[date];
        const dayTemp = dayItems.map(i => i.main.temp);
        const min = Math.min(...dayTemp);
        const max = Math.max(...dayTemp);
        const icon = dayItems[0].weather[0].icon;
        const weather = dayItems[0].weather[0].description;

        const dir = degToDir(dayItems[0].wind.deg);
        const windSpeed = dayItems[0].wind.speed;
        const humidity = dayItems[0].main.humidity;
        const pressure = dayItems[0].main.pressure;

        const dayDiv = document.createElement("div");
        dayDiv.className = "day-block";
        dayDiv.innerHTML = `
          <h3>${convertDateToShamsi(date)}</h3>
          <img src="https://openweathermap.org/img/wn/${icon}.png" alt="">
          <p>${weather}</p>
          <p>🌡️ ${min.toFixed(1)}° ~ ${max.toFixed(1)}°</p>
          <p>💧 رطوبت: ${humidity}%</p>
          <p>🧭 باد: ${windSpeed} m/s (${dir})</p>
          <p>📊 فشار: ${pressure} hPa</p>
          <div class="hourly" id="hourly-${index}"></div>
        `;
        dayDiv.onclick = () => {
          const box = document.getElementById(`hourly-${index}`);
          if (box.style.display === "block") {
            box.style.display = "none";
          } else {
            box.style.display = "block";
            box.innerHTML = dayItems.map(h =>
              `<div class="hourly-item">
                🕒 ${h.dt_txt.split(" ")[1].slice(0,5)} - 
                🌡️ ${h.main.temp.toFixed(1)}°C | 
                💨 ${h.wind.speed} m/s (${degToDir(h.wind.deg)})
              </div>`
            ).join("");
          }
        };
        container.appendChild(dayDiv);
      });
    }

    function degToDir(deg) {
      const dirs = ['شمال', 'شمال شرق', 'شرق', 'جنوب شرق', 'جنوب', 'جنوب غرب', 'غرب', 'شمال غرب'];
      return dirs[Math.round(deg / 45) % 8];
    }

    function convertDateToShamsi(dateStr) {
      const gDate = new Date(dateStr);
      const jDate = new Intl.DateTimeFormat('fa-IR-u-ca-persian', {
        weekday: 'short',
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      }).format(gDate);
      return jDate;
    }

    window.onload = fetchWeather;
  </script>
</body>
</html>
