<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>پیش‌بینی هواشناسی</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background-color: #121212;
      color: #fff;
      margin: 0;
      padding: 20px;
      direction: rtl;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    .lang-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 999;
    }
    input, button {
      font-size: 16px;
      padding: 8px;
      margin: 5px;
      border-radius: 8px;
      border: none;
    }
    #dailyForecast {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .forecast-card {
      background: #1f1f1f;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
    }
    .forecast-card img {
      width: 60px;
      height: 60px;
    }
    .forecast-card h3 {
      font-size: 14px;
      margin: 5px 0;
    }
    footer {
      text-align: center;
      margin-top: 30px;
      font-size: 12px;
      color: #aaa;
    }
  </style>
</head>
<body>

<button class="lang-btn" onclick="switchLanguage()">🌐</button>
<h1 id="title">پیش‌بینی هواشناسی</h1>

<div style="text-align:center;">
  <input type="text" id="cityInput" placeholder="نام شهر را وارد کنید..." onkeypress="if(event.key==='Enter') getWeather()">
  <button onclick="getWeather()">نمایش</button>
</div>

<div id="dailyForecast"></div>

<footer>تمام حقوق محفوظ است © Mehdi Eidani</footer>

<script>
let lang = "fa";
const apiKey = "dc9c93f51cdd375d459483c2a9f86d88";

function switchLanguage() {
  lang = lang === "fa" ? "ar" : "fa";
  document.documentElement.lang = lang;
  document.documentElement.dir = lang === "fa" ? "rtl" : "rtl";

  document.getElementById("title").innerText =
    lang === "fa" ? "پیش‌بینی هواشناسی" : "توقعات الطقس";
  document.getElementById("cityInput").placeholder =
    lang === "fa" ? "نام شهر را وارد کنید..." : "أدخل اسم المدينة...";
  document.querySelector("button[onclick='getWeather()']").innerText =
    lang === "fa" ? "نمایش" : "عرض";

  const city = document.getElementById("cityInput").value;
  if (city) getWeather();
}

function formatDate(dateStr) {
  const date = new Date(dateStr);
  if (lang === "fa") {
    return new Intl.DateTimeFormat("fa-IR", {
      weekday: "long", year: "numeric", month: "long", day: "numeric"
    }).format(date);
  } else {
    return new Intl.DateTimeFormat("ar-EG", {
      weekday: "long", year: "numeric", month: "long", day: "numeric"
    }).format(date);
  }
}

async function getWeather() {
  const city = document.getElementById("cityInput").value || "اهواز";
  const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&lang=${lang}&units=metric&appid=${apiKey}`);
  const data = await response.json();

  const daily = document.getElementById("dailyForecast");

  if (data.cod !== "200") {
    daily.innerHTML = lang === "fa" ? "خطا در دریافت اطلاعات!" : "حدث خطأ!";
    return;
  }

  const days = {};
  data.list.forEach(item => {
    const date = item.dt_txt.split(" ")[0];
    if (!days[date]) days[date] = [];
    days[date].push(item);
  });

  daily.innerHTML = "";
  for (const date in days) {
    const info = days[date][0];
    const maxTemp = Math.max(...days[date].map(d => d.main.temp_max)).toFixed(1);
    const minTemp = Math.min(...days[date].map(d => d.main.temp_min)).toFixed(1);
    const windSpeed = info.wind.speed;
    const windDeg = info.wind.deg;
    const desc = info.weather[0].description;
    const icon = info.weather[0].icon;

    daily.innerHTML += `
      <div class="forecast-card">
        <h3>${formatDate(date)}</h3>
        <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="">
        <p>${desc}</p>
        <p>🔺 ${maxTemp}° | 🔻 ${minTemp}°</p>
        <p>💨 ${windSpeed} m/s</p>
        <p>🧭 ${windDeg}°</p>
      </div>
    `;
  }
}

window.onload = () => {
  document.getElementById("cityInput").value = "اهواز";
  getWeather();
}
</script>
</body>
</html>
