<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</title>
<link href="https://cdn.jsdelivr.net/npm/vazir-font@v1.1.2/dist/font-face.css" rel="stylesheet" />
<style>
  /* ÙÙˆÙ†Øª Ùˆ Ø±Ù†Ú¯â€ŒÙ‡Ø§ */
  html, body {
    height: 100%;
    margin: 0;
    font-family: Vazir, sans-serif;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: #eee;
    direction: rtl;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  header {
    background-color: #064663;
    padding: 1rem 1.2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  }
  header h1 {
    margin: 0;
    font-weight: 900;
    font-size: 1.8rem;
  }
  #langToggle {
    background: #0a9dc7;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 0.5rem 1.2rem;
    cursor: pointer;
    font-weight: 700;
    transition: background 0.3s ease;
  }
  #langToggle:hover {
    background: #0cf;
  }

  main {
    flex: 1 1 auto;
    display: flex;
    gap: 10px;
    padding: 12px;
    box-sizing: border-box;
    overflow: hidden;
  }
  #leftPanel {
    flex: 0 0 350px;
    background: rgba(255 255 255 / 0.07);
    border-radius: 14px;
    padding: 15px 20px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
  }
  #searchSection {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
  #cityInput {
    flex: 1;
    padding: 0.6rem 1rem;
    border-radius: 8px;
    border: none;
    font-size: 1rem;
    outline: none;
    background: rgba(255 255 255 / 0.1);
    color: #eee;
    transition: background 0.3s;
  }
  #cityInput::placeholder {
    color: #bbb;
  }
  #cityInput:focus {
    background: rgba(255 255 255 / 0.2);
  }
  #searchBtn {
    background: #0a9dc7;
    color: white;
    border: none;
    padding: 0 1.2rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    transition: background 0.3s ease;
  }
  #searchBtn:hover {
    background: #0cf;
  }

  #favorites {
    margin-bottom: 20px;
    overflow-x: auto;
    white-space: nowrap;
  }
  #favorites button {
    background: #0a9dc7;
    color: white;
    border: none;
    margin: 0 10px 10px 0;
    padding: 6px 14px;
    border-radius: 12px;
    cursor: pointer;
    display: inline-block;
    white-space: nowrap;
    font-weight: 600;
    transition: background 0.3s ease;
  }
  #favorites button:hover {
    background: #0cf;
  }

  #currentWeather {
    background: rgba(255 255 255 / 0.1);
    border-radius: 14px;
    padding: 15px;
    text-align: center;
    flex-shrink: 0;
    box-shadow: 0 0 12px rgba(10, 157, 199, 0.4);
  }
  #currentWeather h2 {
    margin: 0 0 12px 0;
    font-size: 1.4rem;
    font-weight: 900;
  }
  #currentWeather img {
    width: 110px;
    height: 110px;
  }
  #currentWeather .temp {
    font-size: 3rem;
    font-weight: 900;
    margin: 10px 0;
  }
  #currentWeather .desc {
    font-size: 1.2rem;
    margin-bottom: 12px;
    font-weight: 700;
    text-transform: capitalize;
  }
  #currentWeather .details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    font-size: 0.9rem;
    text-align: left;
  }
  #currentWeather .details div strong {
    color: #0cf;
  }
  #currentWeather button {
    margin-top: 16px;
    padding: 8px 18px;
    font-weight: 700;
    background: #0a9dc7;
    border: none;
    border-radius: 12px;
    color: white;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #currentWeather button:hover {
    background: #0cf;
  }

  #forecastContainer {
    flex: 1 1 auto;
    background: rgba(255 255 255 / 0.07);
    border-radius: 14px;
    padding: 20px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
  }
  #dailyForecast {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding-bottom: 10px;
    scrollbar-width: thin;
    scrollbar-color: #0a9dc7 transparent;
  }
  #dailyForecast::-webkit-scrollbar {
    height: 8px;
  }
  #dailyForecast::-webkit-scrollbar-thumb {
    background: #0a9dc7;
    border-radius: 10px;
  }
  #dailyForecast::-webkit-scrollbar-track {
    background: transparent;
  }
  .day-card {
    background: #0a9dc7cc;
    flex: 0 0 130px;
    border-radius: 14px;
    padding: 12px;
    cursor: pointer;
    user-select: none;
    color: #e0f7fa;
    font-weight: 700;
    display: flex;
    flex-direction: column;
    align-items: center;
    box-shadow: 0 0 10px #0a9dc7aa;
    transition: background 0.3s ease;
  }
  .day-card.active,
  .day-card:hover {
    background: #00bcd4;
    box-shadow: 0 0 20px #00bcd4cc;
  }
  .day-card h3 {
    margin: 0 0 8px 0;
    font-size: 1.1rem;
  }
  .day-card img {
    width: 55px;
    height: 55px;
    margin-bottom: 10px;
  }
  .day-card .temp-row {
    width: 100%;
    font-size: 0.9rem;
    margin-bottom: 6px;
    display: flex;
    justify-content: space-between;
  }
  .day-card .wind-info {
    margin-top: auto;
    font-size: 0.85rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .day-card .wind-info span {
    display: block;
    margin-top: 4px;
  }

  #hourlyToggleBtn {
    background: #0a9dc7;
    border: none;
    color: white;
    padding: 10px 18px;
    font-weight: 700;
    border-radius: 12px;
    cursor: pointer;
    width: fit-content;
    margin: 10px auto 15px auto;
    transition: background 0.3s ease;
  }
  #hourlyToggleBtn:hover {
    background: #00bcd4;
  }
  #hourlyForecast {
    background: #03475e99;
    border-radius: 14px;
    padding: 12px 15px;
    box-sizing: border-box;
    color: #e0f7fa;
    max-height: 320px;
    overflow-y: auto;
    font-size: 0.9rem;
    display: none;
  }
  .hour-card {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid #0cf3;
  }
  .hour-card:last-child {
    margin-bottom: 0;
    border-bottom: none;
  }
  .hour-card img {
    width: 45px;
    height: 45px;
  }
  .hour-info {
    flex: 1;
  }
  .hour-info div {
    margin-bottom: 4px;
  }
  .hour-info div strong {
    color: #0cf;
  }

  footer {
    text-align: center;
    padding: 1rem 1rem;
    font-size: 0.9rem;
    background: #042b3c;
    color: #66d9ff;
    flex-shrink: 0;
    user-select: none;
    box-shadow: inset 0 1px 3px #0af3;
  }
  footer a {
    color: #9ee7ff;
    text-decoration: none;
    font-weight: 700;
    margin: 0 0.4rem;
  }
  footer a:hover {
    text-decoration: underline;
  }
  footer .contact-box {
    margin: 8px 0 0 0;
  }

  /* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
  @media (max-width: 860px) {
    main {
      flex-direction: column;
      height: auto;
    }
    #leftPanel, #forecastContainer {
      max-width: 100%;
      width: 100%;
      margin-bottom: 20px;
    }
    #hourlyForecast {
      max-height: 260px;
    }
  }
</style>
</head>
<body>

<header>
  <h1 id="title">ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</h1>
  <button id="langToggle" onclick="toggleLang()">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
</header>

<main>
  <section id="leftPanel">
    <div id="searchSection">
      <input id="cityInput" type="text" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§ (Ù…Ø«Ù„Ø§Ù‹ Ø§Ù‡ÙˆØ§Ø² ÛŒØ§ Kazemi Do)" />
      <button id="searchBtn" onclick="searchCity()"><span id="searchBtnText">Ø¬Ø³ØªØ¬Ùˆ</span></button>
    </div>
    <div id="favorites"></div>

    <div id="currentWeather"></div>
  </section>

  <section id="forecastContainer">
    <div id="dailyForecast" aria-label="Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ûµ Ø±ÙˆØ²Ù‡"></div>
    <button id="hourlyToggleBtn" onclick="toggleHourly()" style="display:none;">Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ</button>
    <div id="hourlyForecast" aria-label="Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ"></div>
  </section>
</main>

<footer>
  <div>Ø­Ù‚ÙˆÙ‚ Â© mehdi eidani</div>
  <div class="contact-box">
    ØªÙ…Ø§Ø³: <a href="tel:09332356547">09332356547</a> |
    Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…: <a href="https://instagram.com/mehdi.eidani" target="_blank">@mehdi.eidani</a> |
    Ø§ÛŒÙ…ÛŒÙ„: <a href="mailto:mehdi1eidani@gmail.com">mehdi1eidani@gmail.com</a>
  </div>
</footer>

<script>
  const API_KEY = "dc9c93f51cdd375d459483c2a9f86d88";
  let currentLang = "fa";
  let currentUnits = "metric";
  let currentCity = null;
  let favorites = JSON.parse(localStorage.getItem("favorites_weather")) || [];
  let hourlyVisible = false;

  const labels = {
    fa: {
      title: "ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ",
      searchPlaceholder: "Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§ (Ù…Ø«Ù„Ø§Ù‹ Ø§Ù‡ÙˆØ§Ø² ÛŒØ§ Kazemi Do)",
      searchBtn: "Ø¬Ø³ØªØ¬Ùˆ",
      hourlyTitleShow: "Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ",
      hourlyTitleHide: "Ù¾Ù†Ù‡Ø§Ù† Ú©Ø±Ø¯Ù† Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ",
      temp: "Ø¯Ù…Ø§",
      humidity: "Ø±Ø·ÙˆØ¨Øª",
      pressure: "ÙØ´Ø§Ø± Ù‡ÙˆØ§",
      windSpeed: "Ø³Ø±Ø¹Øª Ø¨Ø§Ø¯",
      windDir: "Ø¬Ù‡Øª Ø¨Ø§Ø¯",
      sunrise: "Ø·Ù„ÙˆØ¹ Ø¢ÙØªØ§Ø¨",
      sunset: "ØºØ±ÙˆØ¨ Ø¢ÙØªØ§Ø¨",
      aqi: "Ú©ÛŒÙÛŒØª Ù‡ÙˆØ§",
      favoritesTitle: "Ø´Ù‡Ø±Ù‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Ù‡",
      addFav: "Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§",
      removeFav: "Ø­Ø°Ù Ø§Ø² Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒâ€ŒÙ‡Ø§",
      noFav: "Ø´Ù‡Ø± Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.",
      errorCity: "Ø´Ù‡Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.",
      callText: "ğŸ“ ØªÙ…Ø§Ø³ Ø¨Ø§ 09332356547",
      description: "ØªÙˆØ¶ÛŒØ­Ø§Øª",
      day: "Ø±ÙˆØ²",
      night: "Ø´Ø¨",
      max: "Ø¨ÛŒØ´ÛŒÙ†Ù‡",
      min: "Ú©Ù…ÛŒÙ†Ù‡",
      feelsLike: "Ø§Ø­Ø³Ø§Ø³ ÙˆØ§Ù‚Ø¹ÛŒ",
      dewPoint: "Ù†Ù‚Ø·Ù‡ Ø´Ø¨Ù†Ù…",
      clouds: "Ø§Ø¨Ø±Ù‡Ø§",
      pop: "Ø§Ø­ØªÙ…Ø§Ù„ Ø¨Ø§Ø±Ø´",
      windDirExamples: ["Ø´Ù…Ø§Ù„", "Ø´Ù…Ø§Ù„ Ø´Ø±Ù‚", "Ø´Ø±Ù‚", "Ø¬Ù†ÙˆØ¨ Ø´Ø±Ù‚", "Ø¬Ù†ÙˆØ¨", "Ø¬Ù†ÙˆØ¨ ØºØ±Ø¨", "ØºØ±Ø¨", "Ø´Ù…Ø§Ù„ ØºØ±Ø¨"]
    },
    ar: {
      title: "Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ù…Ù‡Ù†ÙŠØ©",
      searchPlaceholder: "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ù‚Ø±ÙŠØ© (Ù…Ø«Ù„Ø§Ù‹ Ø§Ù„Ø£Ù‡ÙˆØ§Ø² Ø£Ùˆ Kazemi Do)",
      searchBtn: "Ø¨Ø­Ø«",
      hourlyTitleShow: "Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø³Ø§Ø¹Ø©",
      hourlyTitleHide: "Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø³Ø§Ø¹Ø©",
      temp: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©",
      humidity: "Ø§Ù„Ø±Ø·ÙˆØ¨Ø©",
      pressure: "Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¬ÙˆÙŠ",
      windSpeed: "Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­",
      windDir: "Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø±ÙŠØ§Ø­",
      sunrise: "Ø´Ø±ÙˆÙ‚ Ø§Ù„Ø´Ù…Ø³",
      sunset: "ØºØ±ÙˆØ¨ Ø§Ù„Ø´Ù…Ø³",
      aqi: "Ø¬ÙˆØ¯Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡",
      favoritesTitle: "Ø§Ù„Ù…Ø¯Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©",
      addFav: "Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø©",
      removeFav: "Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©",
      noFav: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯Ù† Ù…ÙØ¶Ù„Ø©.",
      errorCity: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©.",
      callText: "ğŸ“ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù„Ù‰ 09332356547",
      description: "Ø§Ù„ÙˆØµÙ",
      day: "Ù†Ù‡Ø§Ø±",
      night: "Ù„ÙŠÙ„",
      max: "Ø§Ù„Ø£Ø¹Ù„Ù‰",
      min: "Ø§Ù„Ø£Ø¯Ù†Ù‰",
      feelsLike: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ³Ø©",
      dewPoint: "Ù†Ù‚Ø·Ø© Ø§Ù„Ù†Ø¯Ù‰",
      clouds: "Ø§Ù„ØºÙŠÙˆÙ…",
      pop: "Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„Ø£Ù…Ø·Ø§Ø±",
      windDirExamples: ["Ø´Ù…Ø§Ù„", "Ø´Ù…Ø§Ù„ Ø´Ø±Ù‚", "Ø´Ø±Ù‚", "Ø¬Ù†ÙˆØ¨ Ø´Ø±Ù‚", "Ø¬Ù†ÙˆØ¨", "Ø¬Ù†ÙˆØ¨ ØºØ±Ø¨", "ØºØ±Ø¨", "Ø´Ù…Ø§Ù„ ØºØ±Ø¨"]
    }
  };

  function toggleLang() {
    currentLang = currentLang === "fa" ? "ar" : "fa";
    document.documentElement.lang = currentLang;
    document.documentElement.dir = "rtl";
    // ØªØºÛŒÛŒØ± Ù…ØªÙˆÙ† Ú©Ù„ÛŒ ØµÙØ­Ù‡
    document.getElementById("title").innerText = labels[currentLang].title;
    document.getElementById("cityInput").placeholder = labels[currentLang].searchPlaceholder;
    document.getElementById("searchBtnText").innerText = labels[currentLang].searchBtn;
    document.getElementById("langToggle").innerText = currentLang === "fa" ? "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" : "ÙØ§Ø±Ø³ÛŒ";

    // ØªØºÛŒÛŒØ± Ú†ÛŒØ¯Ù…Ø§Ù† Ø±Ø§Ø³Øª Ú†ÛŒÙ† (rtl) Ù‡Ø± Ø¯Ùˆ Ø²Ø¨Ø§Ù† Ø¹Ø±Ø¨ÛŒ Ùˆ ÙØ§Ø±Ø³ÛŒ rtl Ù‡Ø³ØªÙ†Ø¯ØŒ Ù¾Ø³ ØªØºÛŒÛŒØ± Ù†Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ….
    renderFavorites();
    if (currentCity) searchCity(currentCity.name);
  }

  function toggleFavorite(cityName) {
    if (favorites.includes(cityName)) {
      favorites = favorites.filter(c => c !== cityName);
    } else {
      favorites.push(cityName);
    }
    localStorage.setItem("favorites_weather", JSON.stringify(favorites));
    renderFavorites();
  }

  function renderFavorites() {
    const favDiv = document.getElementById("favorites");
    favDiv.innerHTML = "";
    if (favorites.length === 0) {
      favDiv.innerText = labels[currentLang].noFav;
      return;
    }
    favorites.forEach(city => {
      const btn = document.createElement("button");
      btn.textContent = city;
      btn.onclick = () => {
        document.getElementById("cityInput").value = city;
        searchCity(city);
      };
      favDiv.appendChild(btn);
    });
  }

  function degToDirection(deg) {
    const directions = labels[currentLang].windDirExamples;
    let index = Math.round(deg / 45) % 8;
    return directions[index];
  }

  async function searchCity(cityName = null) {
    let city = cityName || document.getElementById("cityInput").value.trim();
    if (!city) return alert(labels[currentLang].errorCity);

    try {
      const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(city)}&limit=1&appid=${API_KEY}`);
      const geoData = await geoRes.json();
      if (!geoData.length) return alert(labels[currentLang].errorCity);

      const { lat, lon, name, country } = geoData[0];
      currentCity = { lat, lon, name, country };

      const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=${currentUnits}&lang=${currentLang}&appid=${API_KEY}`);
      const weatherData = await weatherRes.json();

      const currentRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=${currentUnits}&lang=${currentLang}&appid=${API_KEY}`);
      const currentData = await currentRes.json();

      renderCurrent(currentData);
      renderDaily(weatherData);
      renderFavorites();
      document.getElementById("hourlyToggleBtn").style.display = "block";
      hourlyVisible = false;
      document.getElementById("hourlyToggleBtn").innerText = labels[currentLang].hourlyTitleShow;
      document.getElementById("hourlyForecast").style.display = "none";
    } catch (e) {
      alert(labels[currentLang].errorCity);
      console.error(e);
    }
  }

  function renderCurrent(data) {
    if (!data) return;
    const c = labels[currentLang];
    const container = document.getElementById("currentWeather");
    // ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ø¨Ù‡ Ø´Ù…Ø³ÛŒ ÛŒØ§ Ù‡Ø¬Ø±ÛŒ Ø´Ù…Ø³ÛŒ (Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ ÙÙ‚Ø· Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ø´Ù…Ø³ÛŒ Ø³Ø§Ø¯Ù‡)
    function toPersianDate(ts) {
      try {
        // Ú†ÙˆÙ† Ø¨Ù‡ ØµÙˆØ±Øª Ø³Ø§Ø¯Ù‡ Ø§Ø³Øª Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø² Intl.DateTimeFormat Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¨Ø±Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ
        if (currentLang === "fa") {
          return new Intl.DateTimeFormat('fa-IR-u-ca-persian', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            weekday: 'long',
            hour: '2-digit',
            minute: '2-digit'
          }).format(new Date(ts * 1000));
        } else {
          // Ø¹Ø±Ø¨ÛŒ - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªÙ‚ÙˆÛŒÙ… Ù…ÛŒÙ„Ø§Ø¯ÛŒ (Ø¨Ø¯ÙˆÙ† Ø´Ù…Ø³ÛŒ)
          return new Intl.DateTimeFormat('ar-EG', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            weekday: 'long',
            hour: '2-digit',
            minute: '2-digit'
          }).format(new Date(ts * 1000));
        }
      } catch {
        return new Date(ts * 1000).toLocaleString();
      }
    }

    const iconUrl = `https://openweathermap.org/img/wn/${data.weather[0].icon}@4x.png`;

    container.innerHTML = `
      <h2>${data.name} - ${data.sys.country}</h2>
      <img src="${iconUrl}" alt="${data.weather[0].description}" />
      <div class="temp">${Math.round(data.main.temp)}Â°C</div>
      <div class="desc">${data.weather[0].description}</div>
      <div class="details">
        <div><strong>${c.feelsLike}:</strong> ${Math.round(data.main.feels_like)}Â°C</div>
        <div><strong>${c.humidity}:</strong> ${data.main.humidity}%</div>
        <div><strong>${c.pressure}:</strong> ${data.main.pressure} hPa</div>
        <div><strong>${c.windSpeed}:</strong> ${data.wind.speed} m/s</div>
        <div><strong>${c.windDir}:</strong> ${degToDirection(data.wind.deg)}</div>
        <div><strong>${c.sunrise}:</strong> ${toPersianDate(data.sys.sunrise)}</div>
        <div><strong>${c.sunset}:</strong> ${toPersianDate(data.sys.sunset)}</div>
      </div>
      <button onclick="toggleFavorite('${data.name}')">${favorites.includes(data.name) ? c.removeFav : c.addFav}</button>
    `;
  }

  function renderDaily(data) {
    if (!data) return;
    const c = labels[currentLang];
    const container = document.getElementById("dailyForecast");
    container.innerHTML = "";

    // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ 5 Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡ (Ù‡Ø± Ø±ÙˆØ² ÛŒÚ© Ú©Ø§Ø±Øª)
    // openweathermap Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ 3 Ø³Ø§Ø¹ØªÙ‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ØŒ Ù¾Ø³ Ø¨Ø§ÛŒØ¯ Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù†ÛŒÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ Ø±ÙˆØ²
    const days = {};
    data.list.forEach(item => {
      const date = new Date(item.dt * 1000);
      const dayKey = date.toISOString().slice(0, 10); // YYYY-MM-DD
      if (!days[dayKey]) days[dayKey] = [];
      days[dayKey].push(item);
    });

    const dayKeys = Object.keys(days).slice(0, 5);

    dayKeys.forEach(dayKey => {
      const dayItems = days[dayKey];
      // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ù…Ø§ÛŒ Ø¨ÛŒØ´ÛŒÙ†Ù‡ Ùˆ Ú©Ù…ÛŒÙ†Ù‡ Ø±ÙˆØ²
      let maxTemp = -Infinity, minTemp = Infinity, popMax = 0;
      let icon = dayItems[0].weather[0].icon;
      let desc = dayItems[0].weather[0].description;
      let windSpeedAvg = 0;
      let windDegAvg = 0;
      dayItems.forEach(d => {
        if(d.main.temp_max > maxTemp) maxTemp = d.main.temp_max;
        if(d.main.temp_min < minTemp) minTemp = d.main.temp_min;
        if(d.pop > popMax) popMax = d.pop;
        windSpeedAvg += d.wind.speed;
        windDegAvg += d.wind.deg;
      });
      windSpeedAvg = (windSpeedAvg / dayItems.length).toFixed(1);
      windDegAvg = Math.round(windDegAvg / dayItems.length);
      const windDir = degToDirection(windDegAvg);

      // ØªØ§Ø±ÛŒØ® Ù‚Ø§Ø¨Ù„ Ù†Ù…Ø§ÛŒØ´
      let dateObj = new Date(dayKey);
      let dayName;
      if (currentLang === "fa") {
        dayName = new Intl.DateTimeFormat('fa-IR', { weekday: 'long' }).format(dateObj);
      } else {
        dayName = new Intl.DateTimeFormat('ar-EG', { weekday: 'long' }).format(dateObj);
      }

      const card = document.createElement("div");
      card.className = "day-card";
      card.setAttribute("tabindex", "0");
      card.title = desc;
      card.innerHTML = `
        <h3>${dayName}</h3>
        <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${desc}" />
        <div class="temp-row"><span>${c.max}: ${Math.round(maxTemp)}Â°C</span><span>${c.min}: ${Math.round(minTemp)}Â°C</span></div>
        <div class="wind-info">
          <div><strong>${c.windSpeed}:</strong> ${windSpeedAvg} m/s</div>
          <div><strong>${c.windDir}:</strong> ${windDir}</div>
          <div><strong>${c.pop}:</strong> ${(popMax * 100).toFixed(0)}%</div>
        </div>
      `;
      card.onclick = () => {
        renderHourly(dayItems);
        hourlyVisible = true;
        document.getElementById("hourlyForecast").style.display = "block";
        document.getElementById("hourlyToggleBtn").innerText = labels[currentLang].hourlyTitleHide;
      };
      container.appendChild(card);
    });
  }

  function renderHourly(hourlyList) {
    const c = labels[currentLang];
    const container = document.getElementById("hourlyForecast");
    container.innerHTML = "";

    hourlyList.forEach(item => {
      const date = new Date(item.dt * 1000);
      const hour = date.toLocaleTimeString(currentLang === "fa" ? "fa-IR" : "ar-EG", { hour: "2-digit", minute: "2-digit" });
      const iconUrl = `https://openweathermap.org/img/wn/${item.weather[0].icon}@2x.png`;
      const windDir = degToDirection(item.wind.deg);

      const hourCard = document.createElement("div");
      hourCard.className = "hour-card";
      hourCard.innerHTML = `
        <div><strong>${hour}</strong></div>
        <img src="${iconUrl}" alt="${item.weather[0].description}" />
        <div class="hour-info">
          <div>${c.temp}: ${Math.round(item.main.temp)}Â°C ( ${c.feelsLike}: ${Math.round(item.main.feels_like)}Â°C )</div>
          <div>${c.humidity}: ${item.main.humidity}%</div>
          <div>${c.windSpeed}: ${item.wind.speed} m/s - ${c.windDir}: ${windDir}</div>
          <div>${c.pop}: ${(item.pop * 100).toFixed(0)}%</div>
          <div>${c.description}: ${item.weather[0].description}</div>
        </div>
      `;
      container.appendChild(hourCard);
    });
  }

  function toggleHourly() {
    const hourlyDiv = document.getElementById("hourlyForecast");
    const btn = document.getElementById("hourlyToggleBtn");
    if (hourlyVisible) {
      hourlyDiv.style.display = "none";
      btn.innerText = labels[currentLang].hourlyTitleShow;
      hourlyVisible = false;
    } else {
      if(currentCity) searchCity(currentCity.name); // Ø±ÙØ±Ø´ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ
      hourlyDiv.style.display = "block";
      btn.innerText = labels[currentLang].hourlyTitleHide;
      hourlyVisible = true;
    }
  }

  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ - ÛŒÚ© Ø´Ù‡Ø± Ù¾ÛŒØ´ÙØ±Ø¶
  window.onload = () => {
    renderFavorites();
    // Ù¾ÛŒØ´ÙØ±Ø¶ Ø§Ù‡ÙˆØ§Ø²:
    document.getElementById("cityInput").value = currentLang === "fa" ? "Ø§Ù‡ÙˆØ§Ø²" : "Ø§Ù„Ø£Ù‡ÙˆØ§Ø²";
    searchCity(document.getElementById("cityInput").value);
  };
</script>

</body>
</html>
