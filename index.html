<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ù†Ù‚Ø´Ù‡ Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ Ø¬Ù‡Ø§Ù†</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body { margin:0; font-family: Vazir, sans-serif; }
    #map { height: 60vh; }
    #search { padding: 0.5rem; text-align:center; }
    #weather { padding:1rem; text-align:center; }
    .ad-box { position:fixed; bottom:20px; left:20px; background:#fff; border:2px solid #2196f3;
      border-radius:15px; padding:10px; z-index:9999; width:240px; text-align:center;}
    .ad-box a { color:#2196f3; text-decoration:none; font-weight:bold; }
    .close-ad { position:absolute; top:5px; right:8px; cursor:pointer; color:red; font-size:18px;}
  </style>
</head>
<body>
  <header id="search">
    <input type="text" id="city" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§..." style="width:60%;padding:0.5rem;">
    <button onclick="searchCity()">Ø¬Ø³ØªØ¬Ùˆ</button>
  </header>
  <div id="map"></div>
  <div id="weather"></div>
  <div class="ad-box">
    <span class="close-ad" onclick="this.parentElement.style.display='none'">âœ•</span>
    <a href="tel:09332356547">ğŸ“ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</a>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const apiKey = 'dc9c93f51cdd375d459483c2a9f86d88'; // Ú©Ù„ÛŒØ¯ Ø´Ù…Ø§
    const map = L.map('map').setView([31.3, 48.7], 5);
    L.tileLayer(`https://tile.openweathermap.org/map/WND/{z}/{x}/{y}.png?appid=${apiKey}`, {
      opacity:0.5, attribution:'Â© OpenWeatherMap'
    }).addTo(map);

    let marker = null;
    async function searchCity() {
      const name = document.getElementById('city').value.trim();
      if (!name) return alert('Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
      const geo = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(name)},IR&limit=1&appid=${apiKey}`);
      const places = await geo.json();
      if (!places.length) return alert('Ù…Ú©Ø§Ù† ÛŒØ§ÙØª Ù†Ø´Ø¯');
      const {lat, lon, name: placeName} = places[0];
      map.setView([lat,lon],8);
      if (marker) map.removeLayer(marker);
      marker = L.marker([lat,lon]).addTo(map).bindPopup(placeName).openPopup();
      fetchWeather(lat, lon, placeName);
    }

    async function fetchWeather(lat, lon, placeName) {
      const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=fa`);
      const w = await res.json();
      document.getElementById('weather').innerHTML = `
        <h2>${placeName}</h2>
        <p>${w.weather[0].description}</p>
        <p>Ø¯Ù…Ø§ÛŒ ÙØ¹Ù„ÛŒ: ${Math.round(w.main.temp)}Â°C</p>
        <p>Ø±Ø·ÙˆØ¨Øª: ${w.main.humidity}%</p>
        <p>Ø¨Ø§Ø¯: ${Math.round(w.wind.speed)}â€¯m/s Ø¬Ù‡Øª ${windDir(w.wind.deg)}</p>
      `;
    }

    function windDir(deg) {
      const dirs = ['Ø´Ù…Ø§Ù„','Ø´Ù…Ø§Ù„â€ŒØ´Ø±Ù‚ÛŒ','Ø´Ø±Ù‚','Ø¬Ù†ÙˆØ¨â€ŒØ´Ø±Ù‚','Ø¬Ù†ÙˆØ¨','Ø¬Ù†ÙˆØ¨â€ŒØºØ±Ø¨','ØºØ±Ø¨','Ø´Ù…Ø§Ù„â€ŒØºØ±Ø¨'];
      return dirs[Math.round(deg/45)%8];
    }
  </script>
</body>
</html>
