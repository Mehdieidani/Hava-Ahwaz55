<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: sans-serif;
      direction: rtl;
      background: #eef6fb;
      margin: 0;
      padding: 15px;
      color: #003366;
      text-align: center;
    }
    h1, h2, h3 {
      margin: 10px 0;
    }
    #cityInput {
      padding: 10px;
      width: 80%;
      max-width: 320px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #2196f3;
      outline: none;
    }
    button {
      padding: 10px 16px;
      margin: 0 5px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background-color: #2196f3;
      color: white;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0b62c4;
    }
    .ad-box {
      margin: 20px auto;
      background: #fff8dc;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 320px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      color: #d32f2f;
    }
    .ad-box a {
      color: #d32f2f;
      text-decoration: none;
    }
    #mapFrame {
      width: 90%;
      height: 300px;
      border: none;
      border-radius: 12px;
      margin: 15px auto;
      display: block;
    }
    #dailyForecast, #hourlyForecast {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 10px;
    }
    .weather-card, .hour-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 12px;
      width: 140px;
      text-align: center;
      color: #003366;
    }
    .weather-icon {
      width: 60px;
      height: 60px;
      margin: 8px 0;
    }
    .weather-card div, .hour-card div {
      margin: 4px 0;
    }
    .hour-card {
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1 id="title">ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§</h1>
  <input id="cityInput" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§ (Ù…Ø«Ù„Ø§Ù‹ Ø§Ù‡ÙˆØ§Ø² ÛŒØ§ Kazemi Do)" />
  <button onclick="searchCity()">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
  <button id="langToggle" onclick="toggleLang()">AR</button>

  <div class="ad-box">
    <a href="tel:09332356547" id="callLink">ğŸ“ ØªÙ…Ø§Ø³ Ø¨Ø§ 09332356547</a>
  </div>

  <h2 id="cityName">Ø§Ù‡ÙˆØ§Ø²</h2>
  <iframe id="mapFrame" src=""></iframe>

  <h3 id="hourlyTitle">Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ</h3>
  <div id="hourlyForecast"></div>

  <h3 id="dailyTitle">Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ûµ Ø±ÙˆØ²Ù‡</h3>
  <div id="dailyForecast"></div>

  <script>
    const API_KEY = "dc9c93f51cdd375d459483c2a9f86d88";
    let currentLang = "fa";

    const labels = {
      fa: {
        title: "ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨â€ŒÙˆÙ‡ÙˆØ§",
        searchPlaceholder: "Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§ (Ù…Ø«Ù„Ø§Ù‹ Ø§Ù‡ÙˆØ§Ø² ÛŒØ§ Kazemi Do)",
        forecastHourly: "Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ",
        forecastDaily: "Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ûµ Ø±ÙˆØ²Ù‡",
        call: "ğŸ“ ØªÙ…Ø§Ø³ Ø¨Ø§ 09332356547",
        cityNotFound: "Ø´Ù‡Ø± Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯."
      },
      ar: {
        title: "Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù‚Ø³",
        searchPlaceholder: "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ù‚Ø±ÙŠØ©",
        forecastHourly: "ØªÙˆÙ‚Ø¹Ø§Øª ÙƒÙ„ Ø³Ø§Ø¹Ø©",
        forecastDaily: "ØªÙˆÙ‚Ø¹Ø§Øª Ù¥ Ø£ÙŠØ§Ù…",
        call: "ğŸ“ Ø§ØªØµÙ„ Ø¨Ù€ 09332356547",
        cityNotFound: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©."
      }
    };

    function toggleLang() {
      currentLang = currentLang === "fa" ? "ar" : "fa";
      document.getElementById("title").innerText = labels[currentLang].title;
      document.getElementById("cityInput").placeholder = labels[currentLang].searchPlaceholder;
      document.getElementById("langToggle").innerText = currentLang === "fa" ? "AR" : "FA";
      document.getElementById("callLink").innerText = labels[currentLang].call;
      document.getElementById("hourlyTitle").innerText = labels[currentLang].forecastHourly;
      document.getElementById("dailyTitle").innerText = labels[currentLang].forecastDaily;
    }

    async function searchCity() {
      const city = document.getElementById("cityInput").value.trim();
      if (!city) return;
      try {
        const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(city)}&limit=1&appid=${API_KEY}`);
        const geoData = await geoRes.json();
        if (!geoData.length) {
          alert(labels[currentLang].cityNotFound);
          return;
        }

        const { lat, lon, name, country } = geoData[0];
        document.getElementById("cityName").innerText = `${name}, ${country}`;
        document.getElementById("mapFrame").src =
          `https://www.openstreetmap.org/export/embed.html?bbox=${lon - 0.2},${lat - 0.2},${lon + 0.2},${lat + 0.2}&layer=mapnik`;

        const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&lang=${currentLang}&appid=${API_KEY}`);
        const weatherData = await weatherRes.json();

        displayForecast(weatherData);
      } catch (e) {
        alert("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª. Ù„Ø·ÙØ§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.");
        console.error(e);
      }
    }

    function displayForecast(data) {
      const dailyDiv = document.getElementById("dailyForecast");
      const hourlyDiv = document.getElementById("hourlyForecast");
      dailyDiv.innerHTML = "";
      hourlyDiv.innerHTML = "";

      const days = {};

      data.list.forEach(entry => {
        const date = entry.dt_txt.split(" ")[0];
        const hour = parseInt(entry.dt_txt.split(" ")[1].slice(0, 2), 10);
        const iconUrl = `https://openweathermap.org/img/wn/${entry.weather[0].icon}@2x.png`;

        if (!days[date]) days[date] = { day: null, night: null, hours: [] };
        days[date].hours.push({ ...entry, hour, iconUrl });

        // ØªÙÚ©ÛŒÚ© ÙˆØ¶Ø¹ÛŒØª Ø±ÙˆØ² (06-18) Ùˆ Ø´Ø¨ (18-06)
        if (hour >= 6 && hour < 18) {
          if (!days[date].day || entry.main.temp > days[date].day.main.temp) {
            days[date].day = { ...entry, iconUrl };
          }
        } else {
          if (!days[date].night || entry.main.temp < days[date].night.main.temp) {
            days[date].night = { ...entry, iconUrl };
          }
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø³Ø§Ø¹ØªÛŒ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ† Ø±ÙˆØ²
        if (Object.keys(days).length === 1) {
          hourlyDiv.innerHTML += `
            <div class="hour-card" title="${entry.weather[0].description}">
              <div>${entry.dt_txt.split(" ")[1].slice(0,5)}</div>
              <img class="weather-icon" src="${iconUrl}" alt="${entry.weather[0].description}" />
              <div>${entry.main.temp.toFixed(1)}Â°C</div>
              <div>${entry.weather[0].description}</div>
              <div>ğŸ’¨ ${entry.wind.speed} m/s</div>
            </div>
          `;
        }
      });

      for (const date in days) {
        const day = days[date].day;
        const night = days[date].night;

        dailyDiv.innerHTML += `
          <div class="weather-card" title="Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø±ÙˆØ² Ùˆ Ø´Ø¨ Ø¨Ø±Ø§ÛŒ ${date}">
            <div><strong>${date}</strong></div>
            <div><strong>Ø±ÙˆØ²:</strong> ${day ? day.main.temp.toFixed(1) + "Â°C" : "Ù†Ø§Ù…Ø´Ø®Øµ"}</div>
            ${day ? `<img class="weather-icon" src="${day.iconUrl}" alt="Ø±ÙˆØ²">` : ""}
            <div>${day ? day.weather[0].description : ""}</div>

            <div><strong>Ø´Ø¨:</strong> ${night ? night.main.temp.toFixed(1) + "Â°C" : "Ù†Ø§Ù…Ø´Ø®Øµ"}</div>
            ${night ? `<img class="weather-icon" src="${night.iconUrl}" alt="Ø´Ø¨">` : ""}
            <div>${night ? night.weather[0].description : ""}</div>
          </div>
        `;
      }
    }

    window.onload = () => {
      document.getElementById("cityInput").value = "Ø§Ù‡ÙˆØ§Ø²";
      searchCity();
    };
  </script>
</body>
</html>
