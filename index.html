<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>نقشه هواشناسی جهان</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body { margin:0; font-family: Vazir, sans-serif; }
    #map { height: 60vh; }
    #search { padding: 0.5rem; text-align:center; }
    #weather { padding:1rem; text-align:center; }
    .ad-box { position:fixed; bottom:20px; left:20px; background:#fff; border:2px solid #2196f3;
      border-radius:15px; padding:10px; z-index:9999; width:240px; text-align:center;}
    .ad-box a { color:#2196f3; text-decoration:none; font-weight:bold; }
    .close-ad { position:absolute; top:5px; right:8px; cursor:pointer; color:red; font-size:18px;}
  </style>
</head>
<body>
  <header id="search">
    <input type="text" id="city" placeholder="نام شهر یا روستا..." style="width:60%;padding:0.5rem;">
    <button onclick="searchCity()">جستجو</button>
  </header>
  <div id="map"></div>
  <div id="weather"></div>
  <div class="ad-box">
    <span class="close-ad" onclick="this.parentElement.style.display='none'">✕</span>
    <a href="tel:09332356547">📞 تماس با پشتیبانی</a>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const apiKey = 'dc9c93f51cdd375d459483c2a9f86d88'; // کلید شما
    const map = L.map('map').setView([31.3, 48.7], 5);
    L.tileLayer(`https://tile.openweathermap.org/map/WND/{z}/{x}/{y}.png?appid=${apiKey}`, {
      opacity:0.5, attribution:'© OpenWeatherMap'
    }).addTo(map);

    let marker = null;
    async function searchCity() {
      const name = document.getElementById('city').value.trim();
      if (!name) return alert('نام شهر یا روستا را وارد کنید');
      const geo = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${encodeURIComponent(name)},IR&limit=1&appid=${apiKey}`);
      const places = await geo.json();
      if (!places.length) return alert('مکان یافت نشد');
      const {lat, lon, name: placeName} = places[0];
      map.setView([lat,lon],8);
      if (marker) map.removeLayer(marker);
      marker = L.marker([lat,lon]).addTo(map).bindPopup(placeName).openPopup();
      fetchWeather(lat, lon, placeName);
    }

    async function fetchWeather(lat, lon, placeName) {
      const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=fa`);
      const w = await res.json();
      document.getElementById('weather').innerHTML = `
        <h2>${placeName}</h2>
        <p>${w.weather[0].description}</p>
        <p>دمای فعلی: ${Math.round(w.main.temp)}°C</p>
        <p>رطوبت: ${w.main.humidity}%</p>
        <p>باد: ${Math.round(w.wind.speed)} m/s جهت ${windDir(w.wind.deg)}</p>
      `;
    }

    function windDir(deg) {
      const dirs = ['شمال','شمال‌شرقی','شرق','جنوب‌شرق','جنوب','جنوب‌غرب','غرب','شمال‌غرب'];
      return dirs[Math.round(deg/45)%8];
    }
  </script>
</body>
</html>
