<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>پیش‌بینی آب‌وهوا</title>
  <style>
    body {
      background-color: #121212;
      color: #eee;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      direction: rtl;
    }
    header, footer {
      background-color: #222;
      padding: 10px;
      text-align: center;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
      border: none;
    }
    #forecastArea {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
    }
    .day-card {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 10px;
      cursor: pointer;
    }
    .hourly-details {
      display: none;
      margin-top: 10px;
      padding: 10px;
      background: #2a2a2a;
      border-radius: 6px;
    }
    .weather-icon {
      width: 50px;
    }
    .ad-box {
      background-color: #333;
      text-align: center;
      padding: 10px;
      margin-top: 15px;
    }
    .ad-box a {
      color: #00f0ff;
      text-decoration: none;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="title">وضعیت آب‌وهوا</h1>
    <input id="cityInput" placeholder="مثلاً اهواز یا Kazemi Do" />
    <button onclick="searchCity()">🔍 جستجو</button>
    <button id="langToggle" onclick="toggleLang()">AR</button>
  </header>

  <div id="forecastArea"></div>

  <div class="ad-box">
    <a href="tel:09332356547">📞 تماس با 09332356547</a>
    <div style="margin-top:5px;">
      <a href="https://instagram.com/mehdi.eidani" target="_blank">اینستاگرام</a> |
      <a href="mailto:mehdi1eidani@gmail.com">ایمیل</a>
    </div>
  </div>

  <footer>نمایش پیش‌بینی دقیق شب و روز برای کشاورزی و عموم - نسخه پیشرفته</footer>

  <script>
    const API_KEY = "dc9c93f51cdd375d459483c2a9f86d88";
    let currentLang = "fa";

    const labels = {
      fa: {
        title: "وضعیت آب‌وهوا",
        searchPlaceholder: "نام شهر یا روستا (مثلاً اهواز یا Kazemi Do)",
        call: "📞 تماس با 09332356547",
      },
      ar: {
        title: "حالة الطقس",
        searchPlaceholder: "أدخل اسم المدينة أو القرية",
        call: "📞 اتصل بـ 09332356547",
      }
    };

    function toggleLang() {
      currentLang = currentLang === "fa" ? "ar" : "fa";
      document.getElementById("title").innerText = labels[currentLang].title;
      document.getElementById("cityInput").placeholder = labels[currentLang].searchPlaceholder;
      document.getElementById("langToggle").innerText = currentLang === "fa" ? "AR" : "FA";
      document.querySelector(".ad-box a").innerText = labels[currentLang].call;
    }

    async function searchCity() {
      const city = document.getElementById("cityInput").value.trim();
      if (!city) return;

      try {
        const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=1&appid=${API_KEY}`);
        const geoData = await geoRes.json();
        if (!geoData.length) return alert("شهر مورد نظر پیدا نشد.");

        const { lat, lon, name } = geoData[0];
        const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&lang=${currentLang}&appid=${API_KEY}`);
        const data = await res.json();
        renderForecast(data);
      } catch (err) {
        alert("❌ خطا در دریافت اطلاعات هواشناسی.");
        console.error(err);
      }
    }

    function renderForecast(data) {
      const forecastDiv = document.getElementById("forecastArea");
      forecastDiv.innerHTML = "";
      const grouped = {};

      data.list.forEach(item => {
        const date = item.dt_txt.split(" ")[0];
        if (!grouped[date]) grouped[date] = [];
        grouped[date].push(item);
      });

      Object.keys(grouped).forEach(date => {
        const dayItems = grouped[date];
        const main = dayItems[0];
        const icon = main.weather[0].icon;
        const minTemp = Math.min(...dayItems.map(i => i.main.temp_min)).toFixed(1);
        const maxTemp = Math.max(...dayItems.map(i => i.main.temp_max)).toFixed(1);
        const desc = main.weather[0].description;

        const card = document.createElement("div");
        card.className = "day-card";
        card.innerHTML = `
          <strong>${date}</strong><br>
          <img class="weather-icon" src="https://openweathermap.org/img/wn/${icon}@2x.png" />
          <div>🌡 دما: ${minTemp}° ~ ${maxTemp}°</div>
          <div>🌤 وضعیت: ${desc}</div>
        `;

        const details = document.createElement("div");
        details.className = "hourly-details";

        dayItems.forEach(hour => {
          details.innerHTML += `
            <div>
              🕒 ${hour.dt_txt.split(" ")[1].slice(0, 5)} -
              🌡 ${hour.main.temp}°C |
              💧 رطوبت: ${hour.main.humidity}% |
              💨 باد: ${hour.wind.speed} m/s (${hour.wind.deg}°) |
              📈 فشار: ${hour.main.pressure} hPa |
              ☁️ ${hour.weather[0].description}
            </div>
          `;
        });

        card.appendChild(details);
        card.addEventListener("click", () => {
          details.style.display = details.style.display === "none" ? "block" : "none";
        });

        forecastDiv.appendChild(card);
      });
    }

    // Load default city
    window.onload = () => {
      document.getElementById("cityInput").value = "اهواز";
      searchCity();
    };
  </script>
</body>
</html>
