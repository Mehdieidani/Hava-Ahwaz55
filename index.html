<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
  <style>
    body {
      font-family: sans-serif;
      background: #e0f7fa;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background-color: #0288d1;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    .container {
      padding: 1rem;
      max-width: 800px;
      margin: auto;
    }
    .controls {
      margin-bottom: 1rem;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      padding: 0.5rem 1rem;
      background: #0097a7;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 6px;
    }
    button:hover {
      background: #00796b;
    }
    .forecast {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }
    .day {
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
      position: relative;
    }
    .favorite {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      cursor: pointer;
    }
    .feedback, .advert {
      margin-top: 2rem;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .language-toggle {
      float: left;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="title">Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù‡ÙˆØ§</h1>
    <button class="language-toggle" onclick="toggleLanguage()">ğŸ‡®ğŸ‡· / ğŸ‡¸ğŸ‡¦</button>
  </header>

  <div class="container">
    <div class="controls">
      <input type="text" id="cityInput" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
      <button onclick="getWeather()">Ø¬Ø³ØªØ¬Ùˆ ğŸ”</button>
      <button onclick="getLocationWeather()">ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†</button>
    </div>

    <div id="weather" class="forecast"></div>

    <div class="advert">
      <strong>ğŸ”— Ø¢Ú¯Ù‡ÛŒ ØªØ¨Ù„ÛŒØºØ§ØªÛŒ:</strong><br />
      Ø¬Ø§ÛŒÚ¯Ø§Ù‡ ØªØ¨Ù„ÛŒØºØ§ØªÛŒ Ù‚Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ©
    </div>

    <div class="feedback">
      <strong>ğŸ’¬ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª:</strong>
      <p>Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÛŒØ§ Ø§Ù†ØªÙ‚Ø§Ø¯ Ø¯Ø§Ø±ÛŒØ¯ Ø¯Ø± Ø§Ø®ØªÛŒØ§Ø± Ù…Ø§ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯!</p>
    </div>
  </div>

  <script>
    let language = 'fa';

    const translations = {
      fa: {
        title: "Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù‡ÙˆØ§",
        placeholder: "Ù†Ø§Ù… Ø´Ù‡Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯",
        search: "Ø¬Ø³ØªØ¬Ùˆ ğŸ”",
        location: "ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†",
        favorite: "Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ÛŒ",
      },
      ar: {
        title: "ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø·Ù‚Ø³",
        placeholder: "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
        search: "Ø¨Ø­Ø« ğŸ”",
        location: "ğŸ“ Ù…ÙˆÙ‚Ø¹ÙŠ",
        favorite: "Ø§Ù„Ù…ÙØ¶Ù„Ø©",
      }
    };

    function toggleLanguage() {
      language = (language === 'fa') ? 'ar' : 'fa';
      document.documentElement.lang = language;
      document.documentElement.dir = language === 'fa' ? 'rtl' : 'rtl';
      document.getElementById("title").innerText = translations[language].title;
      document.getElementById("cityInput").placeholder = translations[language].placeholder;
      document.querySelector("button[onclick='getWeather()']").innerText = translations[language].search;
      document.querySelector("button[onclick='getLocationWeather()']").innerText = translations[language].location;
    }

    const API_KEY = "dc9c93f51cdd375d459483c2a9f86d88"; // Ú©Ù„ÛŒØ¯ Ø®ÙˆØ¯Øª Ø§Ø² OpenWeather

    function getWeather() {
      const city = document.getElementById("cityInput").value;
      if (!city) return;
      fetchWeatherByCity(city);
    }

    function getLocationWeather() {
      navigator.geolocation.getCurrentPosition((position) => {
        const { latitude, longitude } = position.coords;
        fetchWeatherByCoords(latitude, longitude);
      });
    }

    function fetchWeatherByCity(city) {
      fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&appid=${API_KEY}&lang=${language}`)
        .then(res => res.json())
        .then(data => showForecast(data.list));
    }

    function fetchWeatherByCoords(lat, lon) {
      fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=metric&appid=${API_KEY}&lang=${language}`)
        .then(res => res.json())
        .then(data => showForecast(data.list));
    }

    function showForecast(forecastList) {
      const daily = {};
      forecastList.forEach(item => {
        const date = item.dt_txt.split(" ")[0];
        if (!daily[date]) daily[date] = item;
      });

      const container = document.getElementById("weather");
      container.innerHTML = "";

      Object.values(daily).slice(0, 5).forEach(day => {
        const isFav = localStorage.getItem(day.dt_txt.split(" ")[0]) === "1";
        container.innerHTML += `
          <div class="day">
            <div class="favorite" onclick="toggleFavorite('${day.dt_txt.split(" ")[0]}', this)">
              ${isFav ? 'â­' : 'â˜†'}
            </div>
            <h3>${new Date(day.dt_txt).toLocaleDateString(language)}</h3>
            <img src="https://openweathermap.org/img/wn/${day.weather[0].icon}@2x.png" alt="${day.weather[0].description}" />
            <p>${day.weather[0].description}</p>
            <p>${day.main.temp}Â°C</p>
          </div>
        `;
      });
    }

    function toggleFavorite(date, el) {
      const current = localStorage.getItem(date);
      if (current === "1") {
        localStorage.removeItem(date);
        el.innerText = "â˜†";
      } else {
        localStorage.setItem(date, "1");
        el.innerText = "â­";
      }
    }
  </script>
</body>
</html>
