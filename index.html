<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>هواشناسی پیشرفته</title>
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: #1c1c1c;
      color: #fff;
      margin: 0;
      padding: 0;
      direction: rtl;
    }
    header {
      background: linear-gradient(to left, #ff4500, #ffffff, #d32f2f);
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
    #search {
      text-align: center;
      padding: 1rem;
    }
    input[type="text"] {
      padding: 0.5rem;
      width: 80%;
      border-radius: 5px;
      border: none;
      font-size: 1rem;
    }
    #language-toggle {
      position: absolute;
      left: 1rem;
      top: 1rem;
      padding: 0.4rem 1rem;
      background-color: #ff5722;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .forecast {
      padding: 1rem;
    }
    .day {
      background-color: #2c2c2c;
      margin: 1rem auto;
      padding: 1rem;
      border-radius: 8px;
      width: 90%;
      cursor: pointer;
    }
    .hourly {
      display: none;
      margin-top: 1rem;
      background-color: #333;
      padding: 1rem;
      border-radius: 5px;
    }
    .weather-icon {
      width: 48px;
      height: 48px;
    }
    .advert {
      background: #ffcc00;
      color: #000;
      text-align: center;
      padding: 1rem;
      margin: 1rem;
      border-radius: 8px;
    }
    .favorite-btn {
      background: #ff5722;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 0.3rem 0.8rem;
      margin-top: 0.5rem;
      cursor: pointer;
    }
    .feedback {
      padding: 1rem;
      background: #252525;
      margin: 1rem;
      border-radius: 8px;
    }
    .comment-box {
      margin-top: 1rem;
      background-color: #333;
      padding: 0.5rem;
      border-radius: 5px;
      font-size: 0.9rem;
    }
    footer {
      text-align: center;
      background-color: #111;
      color: #bbb;
      padding: 1rem;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <button id="language-toggle">AR</button>
  <header id="header-title">پیش‌بینی آب‌وهوا</header>
  <div id="search">
    <input type="text" id="searchInput" placeholder="نام شهر یا روستا را وارد کنید..." />
  </div>

  <div id="forecast" class="forecast"></div>

  <div class="feedback">
    <h3>نظرات و پیشنهادات</h3>
    <textarea rows="3" id="commentInput" style="width:100%;"></textarea>
    <br/>
    <button class="favorite-btn" id="submitComment">ارسال</button>
    <div id="commentsContainer"></div>
  </div>

  <div class="advert">
    تماس با ما: <a href="tel:09332356547">09332356547</a><br>
    اینستاگرام: <a href="https://instagram.com/mehdi.eidani" target="_blank">@mehdi.eidani</a><br>
    ایمیل: <a href="mailto:mehdi1eidani@gmail.com">mehdi1eidani@gmail.com</a>
  </div>

  <footer>تمام حقوق متعلق به Mehdi Eidani است</footer>

  <script>
    const apiKey = "dc9c93f51cdd375d459483c2a9f86d88";
    const forecastDiv = document.getElementById("forecast");
    const searchInput = document.getElementById("searchInput");
    const langToggle = document.getElementById("language-toggle");
    const headerTitle = document.getElementById("header-title");
    let lang = "fa";

    function windDirection(deg) {
      const dirs = ["شمال", "شمال‌شرق", "شرق", "جنوب‌شرق", "جنوب", "جنوب‌غرب", "غرب", "شمال‌غرب"];
      return dirs[Math.round(deg / 45) % 8];
    }

    async function getWeather(city) {
      try {
        forecastDiv.innerHTML = "در حال دریافت اطلاعات...";
        const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric&lang=${lang}`);
        const data = await res.json();
        if (!data.list) throw new Error("یافت نشد");
        forecastDiv.innerHTML = "";

        const grouped = {};
        data.list.forEach(item => {
          const day = item.dt_txt.split(" ")[0];
          if (!grouped[day]) grouped[day] = [];
          grouped[day].push(item);
        });

        Object.keys(grouped).forEach((day, i) => {
          const box = document.createElement("div");
          box.className = "day";
          box.innerHTML = `<strong>روز ${i + 1}: ${day}</strong>
            <div>دمای میانگین: ${grouped[day][0].main.temp}°C</div>
            <div>وضعیت: ${grouped[day][0].weather[0].description}</div>
            <div>باد: ${grouped[day][0].wind.speed} km/h - ${windDirection(grouped[day][0].wind.deg)}</div>
            <button class="favorite-btn">پیش‌بینی ساعتی ▼</button>
            <div class="hourly">
              ${grouped[day].map(item => `
                <div style="margin:10px 0;border-bottom:1px solid #555;">
                  ساعت: ${item.dt_txt.split(" ")[1].slice(0,5)}<br/>
                  دما: ${item.main.temp}°C<br/>
                  بیشینه: ${item.main.temp_max} / کمینه: ${item.main.temp_min}<br/>
                  رطوبت: ${item.main.humidity}%<br/>
                  فشار: ${item.main.pressure} hPa<br/>
                  باد: ${item.wind.speed} km/h - ${windDirection(item.wind.deg)}<br/>
                  وضعیت: ${item.weather[0].description}
                </div>`).join('')}
            </div>
          `;
          forecastDiv.appendChild(box);
        });

        document.querySelectorAll(".favorite-btn").forEach(btn => {
          btn.addEventListener("click", () => {
            const next = btn.nextElementSibling;
            next.style.display = next.style.display === "none" ? "block" : "none";
          });
        });

      } catch (err) {
        forecastDiv.innerHTML = "❗ خطا در دریافت اطلاعات، لطفاً دوباره تلاش کنید";
      }
    }

    // نظرات
    const commentInput = document.getElementById("commentInput");
    const submitComment = document.getElementById("submitComment");
    const commentsContainer = document.getElementById("commentsContainer");

    function loadComments() {
      const comments = JSON.parse(localStorage.getItem("comments") || "[]");
      commentsContainer.innerHTML = "";
      comments.forEach((c, i) => {
        const div = document.createElement("div");
        div.className = "comment-box";
        div.textContent = `💬 ${c}`;
        commentsContainer.appendChild(div);
      });
    }

    submitComment.addEventListener("click", () => {
      const val = commentInput.value.trim();
      if (val) {
        const comments = JSON.parse(localStorage.getItem("comments") || "[]");
        comments.push(val);
        localStorage.setItem("comments", JSON.stringify(comments));
        commentInput.value = "";
        loadComments();
        alert("✅ نظر شما ذخیره شد.");
      } else {
        alert("لطفاً یک نظر وارد کنید.");
      }
    });

    loadComments();

    // جستجو
    searchInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        const val = searchInput.value.trim();
        if (val) getWeather(val);
      }
    });

    langToggle.addEventListener("click", () => {
      lang = lang === "fa" ? "ar" : "fa";
      langToggle.textContent = lang === "fa" ? "AR" : "FA";
      headerTitle.textContent = lang === "fa" ? "پیش‌بینی آب‌وهوا" : "توقعات الطقس";
    });

    getWeather("اهواز");
  </script>
</body>
</html>
